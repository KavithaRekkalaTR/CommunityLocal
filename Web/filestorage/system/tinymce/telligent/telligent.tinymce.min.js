(function(){tinymce.PluginManager.add("bottomtoolbar",function(c,u){var q=[];$.each(c.settings.menu,function(s,m){var a=[];$.each((m.items||"").split(/[ ,]/),function(k,p){("|"==p||c.menuItems[p])&&a.push("|"==p?{text:"|"}:c.menuItems[p])});0<a.length&&(c.addButton("menu_"+s,{type:"menubutton",text:m.title||"",menu:a}),q.push("menu_"+s))});q=q.join(" ");0>c.settings.toolbar.indexOf(q)&&(c.settings.toolbar=q+" "+(c.settings.toolbar||""));c.on("Init",function(){var s=c.getContainer(),m=$(".mce-edit-area",
s).css("border-width","0 0 1px 0");$(".mce-menubar",s).hide();$(".mce-toolbar-grp",s).insertAfter(m)})});tinymce.PluginManager.add("customtokens",function(c,u){var q=tinymce.html.Node,s=tinymce.util.JSON,m=this;m.editor=c;m.url=u;m.isTokenSpan=function(a){return a&&"SPAN"===a.nodeName&&this.editor.dom.hasClass(a,"mceCustomTokenItem")};m.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};
m.textToSpan=function(a){var c=this,h=c.editor;if(a.parent){var f={};$.each(c.editor.getParam("evolution_customtokens")||[],function(d,b){f[b.val]=b.label});for(var l=new q("div"),b=/\{([^\}]*)\}/g,g,d=0;g=b.exec(a.value);)(function(){var b=RegExp.$1,n=f[b];if(n){if(0<g.index)for(var r=h.parser.parse(c.resolveWhitespace(a.value.substr(d,g.index-d))),r=r.getAll("p"),v=0;v<r.length;v++)for(var t;null!=(t=r[v].walk());)l.append(t);b={token:"{"+b+"}",placeholder:n};n=new q("span",1);n.attr({id:b.elementId,
"class":"mceItem mceCustomTokenItem mceNonEditable","data-mce-json":s.serialize(b,"'"),contenteditable:"false"});r=new q("#text",3);r.raw=!0;r.value=b.placeholder;n.append(r);l.append(n)}else if(0<g.index)for(r=h.parser.parse(c.resolveWhitespace(a.value.substr(d,g.index-d+RegExp.$0.length))),r=r.getAll("p"),v=0;v<r.length;v++)for(;null!=(t=r[v].walk());)l.append(t)})(),d=b.lastIndex;if(0<d){if(d<a.value.length)for(var b=h.parser.parse(c.resolveWhitespace(a.value.substr(d))).getAll("p"),n=0;n<b.length;n++)for(var r;null!=
(r=b[n].walk());)l.append(r);a.replace(l);l.unwrap()}}};m.spanToObject=function(a,c){var h,f;if(h=a.attr("data-mce-json"))h=s.parse(h),f=new q("#text",3),f.raw=!0,f.value=h.token,a.replace(f)};m.insertToken=function(a,c){var h=this.editor,f={token:a,placeholder:c};h.selection.setContent('<span contenteditable="false" class="mceItem mceCustomTokenItem mceNonEditable" data-mce-json="'+s.serialize(f,"'")+'">'+f.placeholder+"</span>");h.nodeChanged()};m.editor.on("PreInit",function(){m.editor.parser.addNodeFilter("#text",
function(a){for(var c=a.length;c--;)m.textToSpan(a[c])});m.editor.serializer.addNodeFilter("span",function(a,c,h){c=a.length;for(var f;c--;)f=a[c],-1!==(f.attr("class")||"").indexOf("mceCustomTokenItem")&&m.spanToObject(f,h)})});c.on("ResolveName",function(a){"span"===a.name&&m.isTokenSpan(a.target)&&(a.name=tinymce.util.I18n.translate("token"))});var a=[];$.each(m.editor.getParam("evolution_customtokens")||[],function(c,p){a.push({text:p.label,onclick:function(){m.insertToken("{"+p.val+"}",p.label)}})});
c.addMenuItem("customtokens",{text:"Insert token",context:"insert",icon:"code",menu:a});c.addButton("removecustomtoken",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(a){return m.isTokenSpan(a)},"removecustomtoken")});tinymce.PluginManager.add("embeddables",function(c,u){var q=tinymce.html.Node,s=tinymce.util.JSON,m=this,a=null,k=0,p={};m.editor=c;m.url=u;m.isEmbeddableSpan=function(b){return b&&"SPAN"===b.nodeName&&this.editor.dom.hasClass(b,
"mceInsertEmbeddableItem")};m.openDialog=function(b,g){function d(){var d=$(h),b=$("#"+E),g=[],a=b.children(),c=!0;a.each(function(){var d=$(this);g.push(["tab"+g.length,d.data("name"),null,function(){a.hide();d.show()},null]);c?c=!1:d.hide()});if(1<g.length){var f=$("<div></div>");b.prepend(f);f.glowTabSet({cssClass:"tab-set",tabCssClasses:["tab"],tabSelectedCssClasses:["tab selected"],tabHoverCssClasses:["tab hover"],tabs:g,enableResizing:!1});window.setTimeout(function(){f.glowTabSet("selected",
f.glowTabSet("getByIndex",0))},10)}$(".save-form",d).on("click",function(){n();return!1});$(".cancel",d).on("click",function(){$.glowModal.close();return!1})}function n(){p[t]=!0;var d=$.telligent.evolution.url.serializeQuery($("#"+E).dynamicForm("getValues"));tinymce.util.XHR.send({url:l.getCallbackUrl({t:"update-configuration",typeId:g,id:c&&c.id?c.id:""}),data:"configuration="+encodeURIComponent(d),content_type:"application/x-www-form-urlencoded",success:function(b){if(b=tinymce.util.JSON.parse(b))if(!1===
b.valid)$.telligent.evolution.notifications.show(b.validationMessage,{type:"error"});else if(b.configuration){d=b.configuration;var a={typeid:g,id:t,configuration:d,elementId:a&&a.elementId?a.elementId:"mceInsertEmbeddable"+k++};l.editor.execCommand("mceRepaint");l.editor.selection.moveToBookmark(x);a=l.dataToSpan(a);l.editor.selection.setNode(a);l.editor.nodeChanged();$.glowModal.close()}}})}var c=null,f,l=this,h,v="Insert {0}",t,E,x=l.editor.selection.getBookmark(2);if(null!=a&&0!=a.length){var m=
"";f=b?b:l.editor.selection.getNode();if(l.isEmbeddableSpan(f)){if(f=l.editor.dom.getAttrib(f,"data-mce-json"))c=s.parse(f),v="Edit {0}",g=c.typeid}else m=l.editor.selection.getContent({format:"text"});v=tinymce.util.I18n.translate(v);for(f=0;f<a.length;f++)if(a[f].typeid==g){v=v.replace(/\{0\}/,a[f].name);break}tinymce.util.XHR.send({url:l.getCallbackUrl({t:"configure",typeId:g,id:c&&c.id?c.id:""}),data:"configuration="+encodeURIComponent(c&&c.configuration?c.configuration:"")+"&text="+encodeURIComponent(m||
""),content_type:"application/x-www-form-urlencoded",success:function(b){(b=tinymce.util.JSON.parse(b))&&(b.formId&&b.html)&&(E=b.formId,t=b.id,h=$.glowModal({title:tinymce.util.I18n.translate(v),html:['<div class="mceembeddableConfigureEmbeddable">',b.html,'</div><fieldset class="field-list"><ul class="field-list"><li class="field-item"><span class="field-item-input"><a href="#" class="internal-link save-form">',tinymce.util.I18n.translate("Ok"),'</a><a href="#" class="internal-link cancel">',tinymce.util.I18n.translate("Cancel"),
"</a></span></li></ul></fieldset>"].join(""),width:680,height:100}),window.setTimeout(function(){d()},10))}})}};m.resolveWhitespace=function(b){if(!b)return b;" "==b.substr(0,1)&&(b="&nbsp;"+b.substr(1));" "==b.substr(b.length-1)&&(b=b.substr(0,b.length-1)+"&nbsp;");return b};m.textToSpan=function(b){var g=this,d=g.editor;if(b.parent){for(var a=new q("div"),c=/\[embed:([^\]]*)\]/gi,f,l=0;f=c.exec(b.value);)(function(){for(var c=RegExp.$1.split(/:/g),v=c[0],r=c[1],h="",m=2;m<c.length;m++)h+=c[m];p[r]=
!0;var z={id:r,typeid:v,configuration:h,elementId:"mceInsertEmbeddable"+k++};if(0<f.index)for(c=d.parser.parse(g.resolveWhitespace(b.value.substr(l,f.index-l))).getAll("p"),v=0;v<c.length;v++)for(;null!=(r=c[v].walk());)a.append(r);c=new q("span",1);c.attr({id:z.elementId,"class":"mceItem mceInsertEmbeddableItem mceNonEditable","data-mce-json":s.serialize(z,"'"),contenteditable:"false"});a.append(c);g.getPreview(z,function(b,g,a,c,n,f,v){if(a=d.dom.get(z.elementId))c&&$(a).append($('<span class="preview">'+
c+"</span>")),g=$('<span class="type-info">'+g+"</span>"),b&&g.prepend('<img src="'+b+'" />'),n&&$(a).css({"background-image":"url('"+n+"')"}),$(a).append(g);if(""!=f||""!=v)""!=f&&(z.typeid=f),""!=v&&(z.configuration=v),$(a).attr("data-mce-json",s.serialize(z,"'"))})})(),l=c.lastIndex;if(0<l){if(l<b.value.length)for(var c=d.parser.parse(g.resolveWhitespace(b.value.substr(l))).getAll("p"),h=0;h<c.length;h++)for(var v;null!=(v=c[h].walk());)a.append(v);b.replace(a);a.unwrap()}}};m.makeGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(b){var g=16*Math.random()|0;return("x"==b?g:g&3|8).toString(16)})};m.spanToObject=function(b,g){var d;if(d=b.attr("data-mce-json")){d=s.parse(d);var a=m.generateEmbedCode(d);d=new q("#text",3);d.raw=!0;d.value=a;b.replace(d)}};m.dataToSpan=function(b){var g=this.editor,d=this.editor.dom.create("span",{id:b.elementId,"class":"mceItem mceInsertEmbeddableItem mceNonEditable","data-mce-json":s.serialize(b,"'"),contenteditable:"false"});this.getPreview(b,function(d,a,c,f,l,v,t){if(c=g.dom.get(b.elementId))if(f&&
$(c).append($('<span class="preview">'+f+"</span>")),a=$('<span class="type-info">'+a+"</span>"),d&&a.prepend('<img src="'+d+'" />'),l&&$(c).css({"background-image":"url('"+l+"')"}),$(c).append(a),""!=v||""!=t)""!=v&&(b.typeid=v),""!=t&&(b.configuration=t),$(c).attr("data-mce-json",s.serialize(b,"'"))});return d};m.getCallbackUrl=function(b){for(var g=this.url+"../../../apis/embeddables?",d={},a=this.editor.settings.evolution_contextQueryString.split(/&/g),c=0;c<a.length;c++){var f=a[c].split(/=/);
2==f.length&&(d[f[0]]=f[1])}for(var l in b)d[encodeURIComponent(l)]=encodeURIComponent(b[l]);d.contentTypeId=this.editor.getParam("evolution_contenttypeid")||"";b=!0;for(l in d)b?b=!1:g+="&",g+=l+"="+d[l];return g};m.getPreview=function(b,g){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"preview"}),data:"token="+encodeURIComponent(this.generateEmbedCode(b)),content_type:"application/x-www-form-urlencoded",success:function(d){d=tinymce.util.JSON.parse(d);try{d&&d.name?g(d.iconUrl,d.name,d.description,
d.previewHtml,d.previewUrl,d.typeId,d.configuration):g("","","","","","")}catch(b){}},error:function(b){try{g("","","","","","")}catch(a){}}})};m.generateEmbedCode=function(b){var g=b.id;p[g]||(g=m.makeGuid(),p[g]=!0);return"[embed:"+b.typeid+":"+g+":"+b.configuration+"]"};m.editor.on("PreInit",function(){m.editor.parser.addNodeFilter("#text",function(b){for(var g=b.length;g--;)m.textToSpan(b[g])});m.editor.serializer.addNodeFilter("span",function(b,g,d){g=b.length;for(var a;g--;)a=b[g],-1!==(a.attr("class")||
"").indexOf("mceInsertEmbeddableItem")&&m.spanToObject(a,d)})});m.editor.on("init",function(){m.editor.on("dblclick",function(b){b=b.target;if(!m.isEmbeddableSpan(b)&&(b=b.parentNode,!b||!m.isEmbeddableSpan(b)))return;var g=m.editor.dom.getAttrib(b,"data-mce-json");if(g)for(var g=s.parse(g),d=0;d<a.length;d++)a[d].typeid==g.typeid&&a[d].configurable&&m.openDialog(b)})});a=c.settings.evolution_embeddables;c.on("ResolveName",function(b){"span"===b.name&&m.isEmbeddableSpan(b.target)&&(b.name=tinymce.util.I18n.translate("embeddable"))});
for(var h=function(b){return{text:tinymce.util.I18n.translate("Insert {0}").replace(/\{0\}/,b.name),context:"insert",image:0<b.iconUrl.length?b.iconUrl:null,icon:0<b.iconUrl.length?"custom":null,prependToContext:!0,onClick:function(g){b.configurable?m.openDialog(null,b.typeid):(g=m.makeGuid(),p[g]=!0,g={typeid:b.typeid,id:g,configuration:"",elementId:"mceInsertEmbeddable"+k++},m.editor.execCommand("mceRepaint"),g=m.dataToSpan(g),m.editor.selection.setNode(g),m.editor.nodeChanged())}}},f=null,l=0;l<
a.length;l++)(function(b){""==b.categoryid||null!=f&&f.categoryid==b.categoryid||(null!=f&&c.addMenuItem("embedcategory"+f.categoryid,f),f={categoryid:b.categoryid,text:b.category,menu:[]});f?f.menu.push(h(b)):c.addMenuItem("embed"+b.typeid,h(b))})(a[l]);null!=f&&c.addMenuItem("embedcategory"+f.categoryid,f);c.addMenuItem("editembeddable",{text:"Edit embeddable",onclick:function(b){m.openDialog(c.selection.getNode())},context:"edit",prependToContext:!0,onPostRender:function(b){var g=function(){var d=
c.selection.getNode();b.control.hide();if(d&&("SPAN"==d.nodeName&&m.isEmbeddableSpan(d))&&(data=m.editor.dom.getAttrib(d,"data-mce-json")))for(data=s.parse(data),d=0;d<a.length;d++)if(a[d].typeid==data.typeid&&a[d].configurable){var g=b.control.getEl();$(".mce-text",g).text(tinymce.util.I18n.translate("Edit {0}").replace(/\{0\}/,a[d].name));0<a[d].iconUrl.length?$(".mce-ico",g).css("background-image","url('"+a[d].iconUrl+"')"):$(".mce-ico",g).css("background-image","none");b.control.show();break}};
g();c.on("NodeChange",function(){g()},!0)}});c.addButton("editembeddable",{text:"Edit",onclick:function(){m.openDialog(c.selection.getNode())},onPostRender:function(b){var g=function(){var b=c.selection.getNode();d.disabled(!0);if(b&&("SPAN"==b.nodeName&&m.isEmbeddableSpan(b))&&(data=m.editor.dom.getAttrib(b,"data-mce-json")))for(data=s.parse(data),b=0;b<a.length;b++)if(a[b].typeid==data.typeid&&a[b].configurable){d.disabled(!1);break}},d=this;g();c.on("NodeChange",function(){g()},!0)}});c.addButton("removeembeddable",
{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode());c.nodeChanged()}});c.addContextToolbar(function(b){return m.isEmbeddableSpan(b)},"editembeddable removeembeddable")});tinymce.PluginManager.add("emoticons",function(c,u){var q=tinymce.html.Node,s=tinymce.util.JSON,m=1,a=this,k={},p=!1,h=!1,f=/[ \s\t]+/,l=/[ \s\t]/,b,g,d={container:null,selected:null,selectedIndex:-1,current:null},n=null,r=null,w=-1,y=0;a.editor=c;a.url=u;a.openDialog=function(){function b(){$.fn.evolutionTip.hide();
r.empty();k.show();a.loadEmoticons(l.val(),function(b,a){b==l.val()&&(a&&(p=null,$.each(a,function(b,a){r.append($('<div class="mceemoticon-emoticon" data-id="'+a.id+'" tabindex="0" role="button">'+a.previewHtml+"</div>").on("keydown",function(b){13==b.keyCode&&$(this).trigger("click")}).on("click",function(){f(a.id,a.previewHtml)}).on("mouseover",function(){$(this).addClass("mceEmoticonsSelected");var b=this;p!=a.id&&(window.clearTimeout(w),g(),w=window.setTimeout(function(){d(b,a)},333),p=a.id)}).on("mouseout",
function(){$(this).removeClass("mceEmoticonsSelected")}))})),k.hide())})}function d(b,n){var l=n.variations;if(0==l.length)g();else{if(!h){h=document.createElement("div");c.dom.setAttrib(h,"class","mceEmoticonsList mceEmoticonVariationsList");c.dom.setAttrib(h,"style","position:absolute; z-index: 200001;");var v=document.createElement("ul");h.appendChild(v);document.body.appendChild(h)}h.childNodes[0].innerHTML="";h.style.display="block";var v=a.getWindowScrollOffset(window),r=a.getWindowScrollOffset(c.getWin()),
t=null,t=c.dom.getPos(b),t={left:t.x,top:t.y,width:b.offsetWidth,height:b.offsetHeight},k=t.left+t.width;h.style.top=t.top-r.y+v.y+"px";h.style.left=k+"px";$.each(l,function(b,d){var g=document.createElement("li");g.style.cursor="pointer";$(g).append('<span class="mceEmoticonsPreview">'+d.previewHtml+'</span><span class="mceEmoticonsLabel">'+d.name+"</span>");g.onclick=function(){f(d.id,d.previewHtml)};g.onmouseover=function(){g.className="mceEmoticonsSelected"};g.onmouseout=function(){g.className=
""};h.childNodes[0].appendChild(g)})}}function g(){h&&(h.style.display="none");p=null}function f(b,d){var c={id:"mceEmoticon"+m,emoticonId:b};m++;window.clearTimeout(w);g();a.editor.execCommand("mceRepaint");a.editor.selection.setContent('<span contenteditable="false" class="mceItem mceEmoticon mceNonEditable" id="'+c.id+'" data-mce-json="'+s.serialize(c,"'")+'">'+d+"</span>");a.editor.nodeChanged();$.fn.evolutionTip.hide();n.close()}var n,l,r,k,h=null,w=null,p=null;n=a.editor.windowManager.open({title:tinymce.util.I18n.translate("Insert emoticon"),
body:[{type:"container",html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td>\t\t\t<select id="mceemoticon-collection" name="mceemoticon-collection" class="mce-textbox mcemedia-type" style="width: 390px;">\t\t\t</select>\t\t</td>\t</tr>\t</table></td></tr></table><div class="mceemoticon-listwrapper"><div class="mceemoticon-loading"><span class="ui-loading"></span></div><div class="mceemoticon-list"></div></div>'}],
buttons:[{text:"Cancel",onclick:function(){n.close()}}],width:410,height:390});(function(){var d=$(n.getEl());d.on("click",function(){g()});l=$("#mceemoticon-collection",d).glowDropDownList({selectedItemWidth:390,selectedItemHeight:28,itemsWidth:390,itemsHeight:250,itemsHtml:[],showHtmlWhenSelected:!0,className:"mceemoticon-collection"}).on("change",function(){b()});$(".mceemoticon-collection",d).attr("role","button");r=$(".mceemoticon-list",d);k=$(".mceemoticon-loading",d).hide();a.loadEmoticonCollections(function(d){d&&
(l.empty(),$.each(d,function(b,d){l.glowDropDownList("add",l.glowDropDownList("createItem",{value:d.id,text:d.name,html:'<div class="mceemoticon-collectionitem"><div class="mceemoticon-collectionpreview">'+d.previewHtml+'</div><div class="mceemoticon-collectionlabel">'+d.name+"</div>"}))}),l.glowDropDownList("refresh"),b())})})();n.on("close",function(){g()})};a.handleKeyDown=function(b,d){if(p){if(40==d.keyCode)return 1==y?this.highlightNextVariation():this.highlightNextEmoticon(),this.cancelEvent(d);
if(38==d.keyCode)return 1==y?this.highlightPreviousVariation():this.highlightPreviousEmoticon(),this.cancelEvent(d);if(13==d.keyCode)return this.selectEmoticon(b,this.getCurrentWord(b)),h=!1,this.cancelEvent(d);if(27==d.keyCode)return h=!1,this.hideEmoticons(),this.cancelEvent(d);if(37==d.keyCode&&1==y)return a.setVariationMode(0),this.cancelEvent(d);if(39==d.keyCode&&0==y)return a.setVariationMode(1),this.cancelEvent(d)}};a.cancelEvent=function(d){d.preventDefault();d.stopImmediatePropagation();
d.stopPropagation();return!1};a.getLastTypedCharacter=function(d,b){var g=d.getDoc(),a=d.selection.getSel();if(a.focusNode&&a.focusOffset){if(g=a.focusNode.nodeValue,0<=a.focusOffset-1&&g&&g.length>=a.focusOffset)return g.charAt(a.focusOffset-1)}else if(g.selection&&g.selection.createRange){a=g.selection.createRange();if(!(a.parentElement&&a.moveToPoint&&a.moveStart&&a.getBoundingClientRect))return"";if(null!=a.parentElement())try{a.parentElement().focus()}catch(c){}a=g.selection.createRange();g=
a.getBoundingClientRect();0==g.left&&0==g.top&&(a.moveToElementText(a.parentElement()),g=a.getBoundingClientRect(),g.left=g.right);g.left+=0==a.boundingLeft?g.right-g.left:0;g.top=(g.bottom+g.top)/2;a.moveToPoint(g.left,g.top);a.moveStart("character",-1);return a.text}return""};a.handleKeyUp=function(d,a){var c=this.getLastTypedCharacter(d,a);(p||h||":"==c)&&(40!=a.keyCode&&38!=a.keyCode&&13!=a.keyCode&&27!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode)&&(c=this.getCurrentWord(d),h||(b=!0,g=""),100<c.length||
""==c||f.test(c.substr(1))?(h=!1,this.hideEmoticons()):(h=!0,0<c.length&&(b||c.length-1<=g.length||c.substr(1,g.length)!=g)?(p=!0,this.showEmoticons(d,c)):this.hideEmoticons()))};a.setVariationMode=function(d){0==d&&0!=y?(r&&(r.className="",w=-1,r=null),y=0):1==d&&1!=y&&(y=1,a.setHighlightedVariation(0))};a.highlightNextVariation=function(){n&&(r&&n.childNodes[0].childNodes.length>w+1)&&(r.className="",w++,r=n.childNodes[0].childNodes[w],r.className="mceEmoticonsSelected")};a.highlightPreviousVariation=
function(){n&&(r&&0<n.childNodes[0].childNodes.length&&0<w)&&(r.className="",w--,r=n.childNodes[0].childNodes[w],r.className="mceEmoticonsSelected")};a.setHighlightedVariation=function(d){n&&(n.childNodes[0].childNodes.length>d&&0<=d)&&(r&&(r.className=""),w=d,r=n.childNodes[0].childNodes[w],r.className="mceEmoticonsSelected",a.setVariationMode(1))};a.showVariations=function(){if(null!=d.current&&d.current[d.selectedIndex]&&d.current[d.selectedIndex].variations&&0!=d.current[d.selectedIndex].variations.length){var b=
d.current[d.selectedIndex].variations;if(!n){n=document.createElement("div");c.dom.setAttrib(n,"class","mceEmoticonsList mceEmoticonVariationsList");c.dom.setAttrib(n,"style","position:absolute; z-index: 200001;");var g=document.createElement("ul");n.appendChild(g);document.body.appendChild(n)}r=null;n.childNodes[0].innerHTML="";n.style.display="block";var g=this.getWindowScrollOffset(window),f=this.getWindowScrollOffset(c.getWin()),l=null,l=d.container.childNodes[0].childNodes[d.selectedIndex],k=
c.dom.getPos(l),l={left:k.x,top:k.y,width:l.offsetWidth,height:l.offsetHeight},k=l.top+g.y-2*f.y,h=l.left+l.width;l.top+g.y>$(window).height()/2?(n.style.bottom=$("body").outerHeight()-(k+f.y)-l.height+"px",n.style.left=h+"px",n.style.top="auto"):(n.style.top=k+f.y+"px",n.style.left=h+"px",n.style.bottom="auto");r=null;n.childNodes[0].innerHTML="";for(var w=c.selection.getBookmark(2),f=0;f<b.length;f++)g=document.createElement("li"),g.style.cursor="pointer",$(g).html('<span class="mceEmoticonsPreview">'+
b[f].previewHtml+'</span><span class="mceEmoticonsLabel">'+b[f].name+"</span>"),g.onclick=function(){c.selection.moveToBookmark(w);a.selectEmoticon(c,a.getCurrentWord(c))},g.onmouseover=function(){a.setHighlightedVariation(parseInt(c.dom.getAttrib(this,"data-index")))},c.dom.setAttrib(g,"data-index",f),c.dom.setAttrib(g,"data-id",b[f].id),c.dom.setAttrib(g,"data-preview",b[f].previewHtml),n.childNodes[0].appendChild(g)}else a.hideVariations()};a.highlightNextEmoticon=function(){d.container&&(d.selected&&
d.container.childNodes[0].childNodes.length>d.selectedIndex+1)&&(d.selected.className="",d.selectedIndex++,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",a.showVariations())};a.highlightPreviousEmoticon=function(){d.container&&(d.selected&&0<d.container.childNodes[0].childNodes.length&&0<d.selectedIndex)&&(d.selected.className="",d.selectedIndex--,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",
a.showVariations())};a.setHighlightedEmoticon=function(b){d.container&&(d.selected&&d.container.childNodes[0].childNodes.length>b&&0<=b)&&(d.selected.className="",d.selectedIndex=b,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",a.setVariationMode(0),a.showVariations())};a.showEmoticons=function(a,c){var f=this;if(!d.container){d.container=document.createElement("div");a.dom.setAttrib(d.container,"class","mceEmoticonsList");a.dom.setAttrib(d.container,
"style","position:absolute; z-index: 200001;");var n=document.createElement("ul");d.container.appendChild(n);document.body.appendChild(d.container)}d.selected=null;d.container.childNodes[0].innerHTML="";var l=document.createElement("li");d.container.childNodes[0].appendChild(l);$(l).append('<span class="ui-loading"></span>');d.container.style.display="block";var n=this.getWindowScrollOffset(window),r=a.dom.getPos(a.getContentAreaContainer()),k=this.getWindowScrollOffset(a.getWin()),h=a.dom.getPos(a.selection.getNode()),
w=0,p=0,p=a.selection.getRng();p.expand&&p.expand("word");var m=null;0==p.getClientRects().length?p.parentElement&&p.getBoundingClientRect&&p.moveToPoint&&p.moveStart?(p.moveToElementText(p.parentElement()),m=p.getBoundingClientRect(),m.left=m.right,m.left+=0==p.boundingLeft?m.right-m.left:0,p.moveToPoint(m.left,m.top),p.moveStart("character",-1),m=p.getClientRects()[0]):p.insertNode&&(w=a.getWin().document.createElement("span"),p.insertNode(w),m=a.dom.getPos(w),m={left:m.x,top:m.y,width:0,height:w.offsetHeight},
w.parentNode.removeChild(w)):m=p.getClientRects()[0];m&&(!m.width&&!m.height&&m.right&&m.bottom)&&(m={width:m.right-m.left,height:m.bottom-m.top,left:m.left-r.x,top:m.top-r.y});m?(w=m.top+m.height,p=m.left):(w=1.3*parseInt(a.dom.getStyle(a.selection.getNode(),"font-size",!0))+h.y,p=h.x);w+r.y>$(window).height()/2?(d.container.style.bottom=$("body").outerHeight()-(r.y+n.y+w-k.y)+m.height+"px",d.container.style.left=r.x+n.x+p-k.x+"px",d.container.style.top="auto"):(d.container.style.top=r.y+n.y+w-k.y+
"px",d.container.style.left=r.x+n.x+p-k.x+"px",d.container.style.bottom="auto");d.lastSearchText=c;window.clearTimeout(d.searchHandle);var s=a.selection.getBookmark(2);d.searchHandle=window.setTimeout(function(){f.searchForEmoticons(c,function(c,n){if(d.lastSearchText==c)if(f.hideVariations(),d.selected=null,d.container.childNodes[0].innerHTML="",d.current=n||[],n&&0!=n.length){b=!0;g=c;for(var r=0;r<n.length;r++)l=document.createElement("li"),l.style.cursor="pointer",$(l).html('<span class="mceEmoticonsPreview">'+
n[r].previewHtml+'</span><span class="mceEmoticonsLabel">'+n[r].name+"</span>"),l.onclick=function(){a.selection.moveToBookmark(s);f.selectEmoticon(a,f.getCurrentWord(a))},l.onmouseover=function(){f.setHighlightedEmoticon(parseInt(a.dom.getAttrib(this,"data-index")))},a.dom.setAttrib(l,"data-index",r),a.dom.setAttrib(l,"data-id",n[r].id),a.dom.setAttrib(l,"data-preview",n[r].previewHtml),d.container.childNodes[0].appendChild(l),d.selected||(d.selectedIndex=r,d.selected=l,d.selected.className="mceEmoticonsSelected");
f.showVariations()}else b&&(g=c.substr(0,c.length-1),b=!1),f.hideEmoticons()})},249)};a.hideEmoticons=function(b){d.container&&(d.container.style.display="none",d.selected=null,d.selectedIndex=-1);a.hideVariations();p=!1};a.hideVariations=function(d){n&&(n.style.display="none",r=null,w=-1);y=0};a.getCurrentWord=function(d){var b=d.getDoc();d=d.selection.getSel();if(d.focusNode&&d.focusOffset){var b=d.focusNode.nodeValue,g=d.focusOffset-1;if(null==b||0==b.length)return"";d=0;for(var a=g;0<=a;a--)if(":"==
b.charAt(a)){d=a;break}a=b.substr(d,g+1-d);if(0<a.length&&":"==a.charAt(0).toString()&&(0==d||l.test(b.substr(d-1,1))))return a}else if(b.selection&&b.selection.createRange){d=b.selection.createRange();if(!(d.parentElement&&d.moveToPoint&&d.moveStart&&d.getBoundingClientRect))return"";if(null!=d.parentElement())try{d.parentElement().focus()}catch(c){}d=b.selection.createRange();b=d.getBoundingClientRect();0==b.left&&0==b.top&&(d.moveToElementText(d.parentElement()),b=d.getBoundingClientRect(),b.left=
b.right);b.left+=0==d.boundingLeft?b.right-b.left:0;b.top=(b.bottom+b.top)/2;d.moveToPoint(b.left,b.top);d.moveStart("word",-1);d.moveStart("character",-1);b=d.text;d=0;for(a=b.length-1;0<=a;a--)if(":"==b.charAt(a)){d=a;break}a=b.substr(d,b.length-d);if(0<a.length&&":"==a.charAt(0).toString()&&(0==d||l.test(b.substr(d-1,1))))return a}return""};a.selectEmoticon=function(b,g){var a;a=1==y?r:d.selected;if(!(0>=g.length)&&a){var c=b.selection.getRng();if(c.setStart)c.setStart(c.startContainer,c.startOffset-
g.length);else if(c.parentElement&&c.getBoundingClientRect&&c.moveToPoint&&c.moveStart){var f=c.getBoundingClientRect();0==f.left&&0==f.top&&(c.moveToElementText(c.parentElement()),f=c.getBoundingClientRect(),f.left=f.right,f.left+=0==c.boundingLeft?f.right-f.left:0,c.moveToPoint(f.left,f.top));c.moveStart("character",-1*g.length)}f={id:"mceEmoticon"+m,emoticonId:b.dom.getAttrib(a,"data-id")};m++;b.selection.setRng(c);b.selection.setContent('<span contenteditable="false" class="mceItem mceEmoticon mceNonEditable" id="'+
f.id+'" data-mce-json="'+s.serialize(f,"'")+'">'+b.dom.getAttrib(a,"data-preview")+"</span>");b.nodeChanged();this.hideEmoticons()}};a.getWindowScrollOffset=function(d){var b=0,g=0;"number"==typeof d.pageXOffset?(b=d.pageXOffset,g=d.pageYOffset):d.document.body&&(d.document.body.scrollLeft||d.document.body.scrollTop)?(b=d.document.body.scrollLeft,g=d.document.body.scrollTop):d.document.documentElement&&(d.document.documentElement.scrollLeft||d.document.documentElement.scrollTop)&&(b=document.documentElement.scrollLeft,
g=document.documentElement.scrollTop);return{x:b,y:g}};a.getCodePoint=function(d,b){if(null===d)throw TypeError();var g=String(d),a=g.length,c=b?Number(b):0;c!=c&&(c=0);if(!(0>c||c>=a)){var f=g.charCodeAt(c);return 55296<=f&&(56319>=f&&a>c+1)&&(g=g.charCodeAt(c+1),56320<=g&&57343>=g)?{code:1024*(f-55296)+g-56320+65536,isSurrogate:!0}:{code:f,isSurrogate:!1}}};a.spanToObject=function(d,b){var g,a;if(g=d.attr("data-mce-json"))g=s.parse(g),g.emoticonId&&(a=new q("#text",3),a.raw=!0,a.value="[emoticon:"+
g.emoticonId+"]");a?d.replace(a):d.remove()};a.resolveWhitespace=function(d){if(!d)return d;" "==d.substr(0,1)&&(d="&nbsp;"+d.substr(1));" "==d.substr(d.length-1)&&(d=d.substr(0,d.length-1)+"&nbsp;");return d};a.isStart=function(d){return k.unicode&&void 0!==k.unicode[d.toString(16)]};a.requiresMore=function(d){for(var b=k.unicode[d[0].toString(16)],g,a=1;a<d.length;a++){if(void 0===b)return!1;g=b[d[a].toString(16)];if(void 0!==g)b=g;else if(8205!=d[a])return!1}return void 0!==b&&void 0===b.id};a.couldHaveMore=
function(d){for(var b=k.unicode[d[0].toString(16)],g,a=1;a<d.length;a++){if(void 0===b)return!1;g=b[d[a].toString(16)];if(void 0!==g)b=g;else if(8205!=d[a])return!1}return void 0===b?!1:void 0!==b.id?1<Object.keys(b).length:0<Object.keys(b).length};a.isValidCombination=function(d){for(var b=k.unicode[d[0].toString(16)],g,a=1;a<d.length;a++){if(void 0===b)return!1;g=b[d[a].toString(16)];if(void 0!==g)b=g;else if(8205!=d[a])return!1}return void 0!==b&&void 0!==b.id};a.getId=function(d){for(var b=k.unicode[d[0].toString(16)],
g,a=1;a<d.length;a++){if(void 0===b)return null;g=b[d[a].toString(16)];if(void 0!==g)b=g;else if(8205!=d[a])return null}return void 0===b||void 0===b.id?null:b.id};a.parseEmojiInLine=function(){function d(b,g){0>g&&(g=0);if(3==b.nodeType){var a=b.data.length;g>a&&(g=a)}return g}function b(g,a){1!=g.nodeType||g.hasChildNodes()?c.setStart(g,d(g,a)):c.setStartBefore(g)}function g(b,a){1!=b.nodeType||b.hasChildNodes()?c.setEnd(b,d(b,a)):c.setEndAfter(b)}for(var c,f,n,l,r,k,h,w=!0,p=!1,z;w;)(function(){w=
!1;c=a.editor.selection.getRng(!0).cloneRange();if(1>c.startOffset){k=c.endContainer.previousSibling;if(!k){if(!c.endContainer.firstChild||!c.endContainer.firstChild.nextSibling)return;k=c.endContainer.firstChild.nextSibling}h=k.length;b(k,h);g(k,h);if(1>c.endOffset)return;f=c.endOffset;n=k}else{n=c.endContainer;if(3!=n.nodeType&&n.firstChild){for(;3!=n.nodeType&&n.firstChild;)n=n.firstChild;3==n.nodeType&&(b(n,0),g(n,n.nodeValue.length))}f=1==c.endOffset?2:c.endOffset}b(n,Math.max(0,f-200));g(n,
f);r=c.toString();for(var d=0;d<r.length&&!w;d++){var v=a.getCodePoint(r,d),y=!0,q;if(a.isStart(v.code)){z=v.isSurrogate?2:1;m++;var u=[];u.push(v.code);if(a.requiresMore(u))for(;y&&a.requiresMore(u);)(q=a.getCodePoint(r,d+(v.isSurrogate?2:1)))?(u.push(q.code),a.isValidCombination(u)||a.requiresMore(u)?(d+=v.isSurrogate?2:1,v=q,z+=q.isSurrogate?2:1):(u.pop(),y=!1)):y=!1;if(y&&a.couldHaveMore(u))for(;y&&a.couldHaveMore(u);)(q=a.getCodePoint(r,d+(v.isSurrogate?2:1)))?(u.push(q.code),a.isValidCombination(u)||
a.couldHaveMore(u)?(d+=v.isSurrogate?2:1,v=q,z+=q.isSurrogate?2:1):(u.pop(),y=!1)):y=!1;if(a.isValidCombination(u)){l=a.editor.selection.getBookmark();b(n,d+(v.isSurrogate?2:1)-z);g(n,d+(v.isSurrogate?2:1));var F={id:"mceEmoticon"+m,emoticonId:a.getId(u)},y=tinymce.activeEditor.dom.create("span",{id:F.id,"class":"mceItem mceEmoticon mceNonEditable","data-mce-json":s.serialize(F,"'"),contenteditable:"false"});y.appendChild(document.createTextNode(tinymce.util.I18n.translate("???")));a.editor.selection.setRng(c);
a.editor.selection.setNode(y);a.getPreview(F,function(d){var b=a.editor.dom.get(F.id);b&&(b.innerHTML=d)});p=w=!0;a.editor.selection.moveToBookmark(l)}}v.isSurrogate&&d++}})();p&&(a.editor.selection.moveToBookmark(l),a.editor.nodeChanged())};a.replaceEmojiInText=function(d){for(var b,g=0;g<d.length;g++){var c=a.getCodePoint(d,g);b=a.isStart(c.code);var f=!0,n,l=g;if(b){b=c.isSurrogate?2:1;m++;var r=[];r.push(c.code);if(a.requiresMore(r))for(;f&&a.requiresMore(r);)(n=a.getCodePoint(d,g+(c.isSurrogate?
2:1)))?(r.push(n.code),a.isValidCombination(r)||a.requiresMore(r)?(g+=c.isSurrogate?2:1,c=n,b+=n.isSurrogate?2:1):(r.pop(),f=!1)):f=!1;if(f&&a.couldHaveMore(r))for(;f&&a.couldHaveMore(r);)(n=a.getCodePoint(d,g+(c.isSurrogate?2:1)))?(r.push(n.code),a.isValidCombination(r)||a.couldHaveMore(r)?(g+=c.isSurrogate?2:1,c=n,b+=n.isSurrogate?2:1):(r.pop(),f=!1)):f=!1;a.isValidCombination(r)&&(f="[emoticon:"+a.getId(r)+"]",d=d.substr(0,l)+f+d.substr(l+b),g+=b-(c.isSurrogate?2:1))}c.isSurrogate&&g++}return d};
a.textToSpan=function(d){var b=this,g=b.editor;if(d.parent){for(var a=new q("div"),c=/\[emoticon:([^\]]+)\]/g,f,n=0;f=c.exec(d.value);)(function(){var c={id:"mceEmoticon"+m,emoticonId:RegExp.$1};if(0<f.index)for(var l=g.parser.parse(b.resolveWhitespace(d.value.substr(n,f.index-n))).getAll("p"),r=0;r<l.length;r++)for(var k;null!=(k=l[r].walk());)a.append(k);l=new q("span",1);a.append(l);l.attr({id:c.id,"class":"mceItem mceEmoticon mceNonEditable","data-mce-json":s.serialize(c,"'"),contenteditable:"false"});
r=new q("#text",3);r.raw=!0;r.value=tinymce.util.I18n.translate("???");l.append(r);b.getPreview(c,function(d){var b=g.dom.get(c.id);b&&(b.innerHTML=d)})})(),n=c.lastIndex,m++;if(0<n){if(n<d.value.length)for(var c=g.parser.parse(b.resolveWhitespace(d.value.substr(n))).getAll("p"),l=0;l<c.length;l++)for(var r;null!=(r=c[l].walk());)a.append(r);d.replace(a);a.unwrap()}}};a.getPreview=function(d,b){tinymce.util.XHR.send({url:a.getCallbackUrl({t:"p",emoticonId:d.emoticonId}),success:function(d){d=tinymce.util.JSON.parse(d);
try{d&&d.html?b(d.html):b("")}catch(g){}},error:function(d){try{b("")}catch(g){}}})};a.searchForEmoticons=function(d,b){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"searchemoticons",query:d}),success:function(g){g=tinymce.util.JSON.parse(g);try{g&&g.emoticons?b(d,g.emoticons):b(d,null)}catch(a){}},error:function(g){try{b(d,null)}catch(a){}}})};a.loadEmoticonCollections=function(d){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"listcollections"}),success:function(b){b=tinymce.util.JSON.parse(b);
try{b&&b.collections?d(b.collections):d(null)}catch(g){}},error:function(b){try{d(null)}catch(g){}}})};a.loadEmoticons=function(d,b){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"listemoticons",collectionId:d}),success:function(g){g=tinymce.util.JSON.parse(g);try{g&&g.emoticons?b(d,g.emoticons):b(d,null)}catch(a){}},error:function(g){try{b(d,null)}catch(a){}}})};a.loadEmoji=function(){tinymce.util.XHR.send({url:a.url+"../../../apis/emoticons?t=emojijson",success:function(d){d=tinymce.util.JSON.parse(d);
try{d&&(k=d)}catch(b){}},error:function(d){}})};a.getCallbackUrl=function(d){for(var b=this.url+"../../../apis/emoticons?",g={},a=this.editor.settings.evolution_contextQueryString.split(/&/g),c=0;c<a.length;c++){var f=a[c].split(/=/);2==f.length&&(g[f[0]]=f[1])}for(var n in d)g[encodeURIComponent(n)]=encodeURIComponent(d[n]);d=!0;for(n in g)d?d=!1:b+="&",b+=n+"="+g[n];return b};var z=!0===c.getParam("evolution_emoticons");c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(d){for(var b=
d.length;b--;)a.textToSpan(d[b])});c.serializer.addNodeFilter("span",function(d,b,g){b=d.length;for(var c;b--;)c=d[b],-1!==(c.attr("class")||"").indexOf("mceEmoticon")&&a.spanToObject(c,g)});c.on("keyup",function(d){a.parseEmojiInLine();if(z)return a.handleKeyUp(c,d)},!0);z&&(c.on("keydown",function(d){return a.handleKeyDown(c,d)},!0),c.on("click",function(){a.hideEmoticons()}))});z&&(c.addCommand("mceInsertEmoticon",function(){a.openDialog()}),c.addMenuItem("emoticon",{text:"Insert emoticon",icon:"emoticons",
cmd:"mceInsertEmoticon",context:"insert",prependToContext:!0}));c.on("ResolveName",function(d){"span"===d.name&&c.dom.hasClass(d.target,"mceEmoticon")&&(d.name=tinymce.util.I18n.translate("emoticon"))});c.on("PastePreProcess",function(d){d.content=a.replaceEmojiInText(d.content)});c.on("BeforeSetContent",function(d){d.content=a.replaceEmojiInText(d.content)});c.addButton("emoticonremove",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(d){return c.dom.is(d,
"span.mceEmoticon")&&c.getBody().contains(d)},"emoticonremove");a.loadEmoji()});(function(){function c(u,q,s){return u?u.is("body")?u.css(q)==s:u.css(q)==s?c(u.parent(),q,s):!1:!1}tinyMCE.$.cssHooks.fontFamily={get:function(u){if(u&&("#"==u.nodeName.substr(0,1)||"BODY"==u.nodeName))return"inherit";u=$(u);var q=u.css("font-family");return c(u.parent(),"font-family",q)?"inherit":q}};tinyMCE.$.cssHooks.fontSize={get:function(u){if(u&&("#"==u.nodeName.substr(0,1)||"BODY"==u.nodeName))return"inherit";
u=$(u);var q=u.css("font-size");return c(u.parent(),"font-size",q)?"inherit":q}}})();tinymce.PluginManager.add("enhancements",function(c,u){function q(d,b){for(var g=0;g<b.length;g++)if(d.nodeName==b[g])return!0;return d.parentNode?q(d.parentNode,b):!1}function s(){h.enhancements_initialheight=$(c.getContainer()).height();c.save();c.remove()}function m(){if(tinymce.EditorManager.get(a))return!1;var d=new tinymce.Editor(a,h,tinymce);d.render();$(d.getContainer()).css({display:""});return!0}var a=c.id,
k,p,h=c.settings,f=null;window.mceReflow=window.mceReflow||{};k=$.telligent.evolution.messaging.subscribe("reflow.reflowstart",function(d){var b=tinymce.EditorManager.get(a);b&&(d.target&&d.target.has&&0<d.target.has(b.getContainer()).length)&&($.telligent.evolution.messaging.unsubscribe(k),window.mceReflow[a]=!0,s())});p=$.telligent.evolution.messaging.subscribe("reflow.reflowend",function(d){var b=$("#"+a);0<b.length&&(d.target&&d.target.has&&0<d.target.has(b[0]).length)&&window.mceReflow[a]&&(m()&&
$.telligent.evolution.messaging.unsubscribe(p),window.mceReflow[a]=!1)});c.on("remove",function(d){window.mceReflow[a]||$.telligent.evolution.messaging.unsubscribe(p);$.telligent.evolution.messaging.unsubscribe(k)});c.on("contextmenu",function(d){(""==$.trim(c.selection.getContent({format:"text"}))||d.shiftKey)&&q(d.target,["TABLE","TBODY","TR","TH","TD"])||d.stopImmediatePropagation()},!0);c.on("PreInit",function(){function d(d){var b=c.theme.panel.find(d)[0];null!=b&&window.setTimeout(function(){try{var d=
b.keyboardNav||b.parents().eq(-1)[0].keyboardNav;d&&d.focusFirst(b)}catch(g){}},10)}var b=$(c.getContainer());c.settings.enhancements_wrappercss&&b.addClass(c.settings.enhancements_wrappercss);b.addClass("mce-editor-blur").removeClass("mce-editor-focus");b.css({height:(h.enhancements_initialheight||c.settings.height||300)+"px",overflow:"hidden"});c.shortcuts.add("Shift+Alt+M","",function(){c.plugins.bottomtoolbar?d("toolbar"):d("menubar")});c.shortcuts.add("Shift+Alt+T","",function(){d("toolbar")});
c.shortcuts.add("Shift+Alt+C","",function(){c.notificationManager.close()});var g=$("iframe",c.getContentAreaContainer()).get(0);$(function(){$.telligent.evolution.shortcuts.register("shift+alt+m",function(d){return!0},{description:tinymce.util.I18n.translate("Open menu"),scope:g});$.telligent.evolution.shortcuts.register("shift+alt+t",function(d){return!0},{description:tinymce.util.I18n.translate("Open toolbar"),scope:g});$.telligent.evolution.shortcuts.register("shift+alt+c",function(d){return!0},
{description:tinymce.util.I18n.translate("Close editor notifications"),scope:g})});c.on("keyup",function(d){if(d.altKey||d.ctrlKey||d.metaKey)return document.dispatchEvent(new KeyboardEvent("keyup",{key:d.key,code:d.code,location:d.location,ctrlKey:d.ctrlKey,shiftKey:d.shiftKey,altKey:d.altKey,metaKey:d.metaKey,charCode:d.charCode,keyCode:d.keyCode,which:d.which,cancelable:!0}))});c.on("keydown",function(d){if(d.altKey||d.ctrlKey||d.metaKey)return document.dispatchEvent(new KeyboardEvent("keydown",
{key:d.key,code:d.code,location:d.location,ctrlKey:d.ctrlKey,shiftKey:d.shiftKey,altKey:d.altKey,metaKey:d.metaKey,charCode:d.charCode,keyCode:d.keyCode,which:d.which,cancelable:!0}))})});c.on("Init",function(){window.setTimeout(function(){$(c.getContainer()).css({height:"auto",overflow:"visible"})},10);$("html").prop("lang")&&$(c.getBody()).closest("html").prop("lang",$("html").prop("lang"));$(c.getContainer()).find("button.mce-open").prop("title",tinymce.util.I18n.translate("Select"));var d=$(c.getElement()),
b=null,g,a=$("iframe",c.getContentAreaContainer());0<d.length&&(b=d.prop("id")||null,(g=d.attr("aria-labelledby"))&&a.attr("aria-labelledby",g),(g=d.attr("aria-describedby"))&&a.attr("aria-describedby",g),(g=d.attr("aria-label"))&&a.attr("aria-label",g));b&&$('label[for="'+b+'"]').each(function(){$(this).prop("for",a.prop("id")||null)})});c.on("focus",function(){var d=$(c.getContainer());d.hasClass("mce-editor-blur")&&d.removeClass("mce-editor-blur").addClass("mce-editor-focus")});c.on("blur",function(){var d=
$(c.getContainer());d.hasClass("mce-editor-blur")&&d.addClass("mce-editor-blur").removeClass("mce-editor-focus")});0<=c.settings.plugins.indexOf("autoresize")&&(c.settings.autoresize_max_height=0.67*$(window).height(),$(window).on("resized",function(){c.settings.autoresize_max_height=0.67*$(window).height()}));if(c.settings.enhancements_placeholder){var l=$('<div class="mce-placeholder"></div>').html(c.settings.enhancements_placeholder).on("click",function(){c.execCommand("mceFocus",!1)}),b=!0,g=
function(){var d=c.getContent();return d&&0<d.length&&!/^(<p>\s*?<\/p>|\s*|<div>\s*?<\/div>)*$/i.test(d)?!0:!1};c.on("init",function(){$(c.getContentAreaContainer()).css("position","relative").append(l);g()?l.hide():l.show()});c.on("focus",function(){b&&(l.hide(),b=!1)});c.on("blur",function(){g()?l.hide():l.show();b=!0});c.on("change setContent",function(){b&&(g()?l.hide():l.show())})}c.addMenuItem("removelink",{text:"Remove link",cmd:"unlink",context:"edit",prependToContext:!0,onPostRender:function(d){d.control.hide();
c.on("NodeChange",function(){"A"==c.selection.getNode().nodeName?d.control.show():d.control.hide()},!0)}});c.addMenuItem("editlink",{text:"Edit link",icon:"link",cmd:"mceLink",context:"edit",prependToContext:!0,onPostRender:function(d){d.control.hide();c.on("NodeChange",function(){"A"==c.selection.getNode().nodeName?d.control.show():d.control.hide()},!0)}});c.addMenuItem("insertlink",{text:"Insert link",icon:"link",cmd:"mceLink",context:"insert",prependToContext:!0,onPostRender:function(d){d.control.hide();
c.on("NodeChange",function(){"A"==c.selection.getNode().nodeName?d.control.hide():d.control.show()},!0)}});c.addMenuItem("indent",{text:"Indent",icon:"indent",cmd:"indent",context:"format"});c.addMenuItem("outdent",{text:"Outdent",icon:"outdent",cmd:"outdent",context:"format"});c.on("dblclick",function(d){"A"==c.selection.getNode().nodeName&&c.execCommand("mceLink")});return{moveTo:function(d,b){if(!0===b||$("#"+a).parent()[0]!=$(d)[0])s(),$("#"+a).appendTo(d),m()},focusAndView:function(){var d=function(){var b=
$(c.getContainer()),g=b.offset();if(b=b.height()){var a=$(window),l=a.scrollTop(),a=a.height(),k=Math.max(0,a-$("body").height());l+a<g.top+b?$("body, html").animate({scrollTop:(b>a-k?g.top-k:g.top-(a-b-5))+"px"},200,"swing",function(){c.focus()}):l+k>g.top?$("body, html").animate({scrollTop:g.top-k+"px"},200,"swing",function(){c.focus()}):c.focus()}else window.clearTimeout(f),f=window.setTimeout(function(){d()},50)};d()}}});tinymce.PluginManager.add("hashtags",function(c,u){var q=tinymce.html.Node,
s=tinymce.util.JSON,m=!1,a=!1,k=/[-_~`!@#$%^&*()=+{[}\]\\|;:'",<.> \s\t]+/i,p,h,f={container:null,selected:null,selectedIndex:-1},l=1,b=this;b.editor=c;b.url=u;b.handleKeyDown=function(b,d){if(!this.disabledState&&m){if(40==d.keyCode)return this.highlightNextHashtag(),this.cancelEvent(d);if(38==d.keyCode)return this.highlightPreviousHashtag(),this.cancelEvent(d);if(13==d.keyCode||9==d.keyCode)return this.selectHashtag(b,this.getCurrentWord(b)),a=!1,this.cancelEvent(d);if(27==d.keyCode)return a=!1,
this.hideHashtags(),this.cancelEvent(d)}};b.cancelEvent=function(b){b.preventDefault();b.stopImmediatePropagation();b.stopPropagation();return!1};b.getLastTypedCharacter=function(b,d){var a=b.getDoc(),c=b.selection.getSel();if(c.focusNode&&c.focusOffset){if(a=c.focusNode.nodeValue,0<=c.focusOffset-1&&a&&a.length>=c.focusOffset)return a.charAt(c.focusOffset-1)}else if(a.selection&&a.selection.createRange){c=a.selection.createRange();if(!(c.parentElement&&c.moveToPoint&&c.moveStart&&c.getBoundingClientRect))return"";
if(null!=c.parentElement())try{c.parentElement().focus()}catch(f){}c=a.selection.createRange();a=c.getBoundingClientRect();0==a.left&&0==a.top&&(c.moveToElementText(c.parentElement()),a=c.getBoundingClientRect(),a.left=a.right);a.left+=0==c.boundingLeft?a.right-a.left:0;a.top=(a.bottom+a.top)/2;c.moveToPoint(a.left,a.top);c.moveStart("character",-1);return c.text}return""};b.handleKeyUp=function(b,d){if(!this.disabledState){var c=this.getLastTypedCharacter(b,d);(m||a||"#"==c)&&(40!=d.keyCode&&38!=
d.keyCode&&13!=d.keyCode&&27!=d.keyCode)&&(c=this.getCurrentWord(b),a||(p=!0,h=""),256<c.length||""==c||k.test(c.substr(1))?(a=!1,this.hideHashtags()):(a=!0,2<c.length&&(p||c.length-1<=h.length||c.substr(1,h.length)!=h)?(m=!0,this.showHashtags(b,c.substr(1))):this.hideHashtags()))}};b.highlightNextHashtag=function(){f.container&&(f.selected&&f.container.childNodes[0].childNodes.length>f.selectedIndex+1)&&(f.selected.className="",f.selectedIndex++,f.selected=f.container.childNodes[0].childNodes[f.selectedIndex],
f.selected.className="mceHashtagsSelected")};b.highlightPreviousHashtag=function(){f.container&&(f.selected&&0<f.container.childNodes[0].childNodes.length&&0<f.selectedIndex)&&(f.selected.className="",f.selectedIndex--,f.selected=f.container.childNodes[0].childNodes[f.selectedIndex],f.selected.className="mceHashtagsSelected")};b.setHighlightdHashtag=function(b){f.container&&(f.selected&&f.container.childNodes[0].childNodes.length>b&&0<=b)&&(f.selected.className="",f.selectedIndex=b,f.selected=f.container.childNodes[0].childNodes[f.selectedIndex],
f.selected.className="mceHashtagsSelected")};b.showHashtags=function(b,d){var a=this;if(!f.container){f.container=document.createElement("div");b.dom.setAttrib(f.container,"class","mceHashtagsList");b.dom.setAttrib(f.container,"style","position:absolute; z-index: 200001;");var c=document.createElement("ul");f.container.appendChild(c);document.body.appendChild(f.container)}f.selected=null;f.container.childNodes[0].innerHTML="";var l=document.createElement("li");f.container.childNodes[0].appendChild(l);
$(l).append('<span class="ui-loading"></span>');f.container.style.display="block";var c=this.getWindowScrollOffset(window),k=b.dom.getPos(b.getContentAreaContainer()),m=this.getWindowScrollOffset(b.getWin()),s=b.dom.getPos(b.selection.getNode()),t=0,q=0,q=b.selection.getRng(),x=null;0==q.getClientRects().length?q.parentElement&&q.getBoundingClientRect&&q.moveToPoint&&q.moveStart?(q.moveToElementText(q.parentElement()),x=q.getBoundingClientRect(),x.left=x.right,x.left+=0==q.boundingLeft?x.right-x.left:
0,q.moveToPoint(x.left,x.top),q.moveStart("character",-1),x=q.getClientRects()[0]):q.insertNode&&(t=b.getWin().document.createElement("span"),q.insertNode(t),x=b.dom.getPos(t),x={left:x.x,top:x.y,width:0,height:t.offsetHeight},t.parentNode.removeChild(t)):x=q.getClientRects()[0];x&&(!x.width&&!x.height&&x.right&&x.bottom)&&(x={width:x.right-x.left,height:x.bottom-x.top,left:x.left-k.x,top:x.top-k.y});x?(t=x.top+x.height,q=x.left):(t=1.3*parseInt(b.dom.getStyle(b.selection.getNode(),"font-size",!0))+
s.y,q=s.x);t+k.y>$(window).height()/2?(f.container.style.bottom=$("body").outerHeight()-(k.y+c.y+t-m.y)+x.height+"px",f.container.style.left=k.x+c.x+q-m.x+"px",f.container.style.top="auto"):(f.container.style.top=k.y+c.y+t-m.y+"px",f.container.style.left=k.x+c.x+q-m.x+"px",f.container.style.bottom="auto");f.lastSearchText=d;window.clearTimeout(f.searchHandle);var u=b.selection.getBookmark(2);f.searchHandle=window.setTimeout(function(){a.searchForHashtags(d,function(d,c){if(f.lastSearchText==d)if(f.selected=
null,f.container.childNodes[0].innerHTML="",c&&0!=c.length){p=!0;h=d;for(var r=0;r<c.length;r++)l=document.createElement("li"),l.style.cursor="pointer",l.innerHTML=c[r].previewhtml,l.onclick=function(){b.selection.moveToBookmark(u);a.selectHashtag(b,a.getCurrentWord(b))},l.onmouseover=function(){a.setHighlightdHashtag(parseInt(b.dom.getAttrib(this,"data-index")))},b.dom.setAttrib(l,"data-index",r),b.dom.setAttrib(l,"data-tagname",c[r].name),f.container.childNodes[0].appendChild(l),f.selected||(f.selectedIndex=
r,f.selected=l,f.selected.className="mceHashtagsSelected")}else p&&(h=d.substr(0,d.length-1),p=!1),a.hideHashtags()})},249)};b.hideHashtags=function(b){f.container&&(f.container.style.display="none",f.selected=null,f.selectedIndex=-1);m=!1};b.getCurrentWord=function(b){var d=b.getDoc();b=b.selection.getSel();if(b.focusNode&&b.focusOffset){var d=b.focusNode.nodeValue,a=b.focusOffset-1;if(null==d||0==d.length)return"";b=0;for(var c=a;0<=c;c--)if("#"==d.charAt(c)){b=c;break}d=d.substr(b,a+1-b);if(0<
d.length&&"#"==d.charAt(0).toString())return d}else if(d.selection&&d.selection.createRange){b=d.selection.createRange();if(!(b.parentElement&&b.moveToPoint&&b.moveStart&&b.getBoundingClientRect))return"";if(null!=b.parentElement())try{b.parentElement().focus()}catch(f){}b=d.selection.createRange();d=b.getBoundingClientRect();0==d.left&&0==d.top&&(b.moveToElementText(b.parentElement()),d=b.getBoundingClientRect(),d.left=d.right);d.left+=0==b.boundingLeft?d.right-d.left:0;d.top=(d.bottom+d.top)/2;
b.moveToPoint(d.left,d.top);b.moveStart("word",-1);b.moveStart("character",-1);d=b.text;b=0;for(c=d.length-1;0<=c;c--)if("#"==d.charAt(c)){b=c;break}d=d.substr(b,d.length-b);if(0<d.length&&"#"==d.charAt(0).toString())return d}return""};b.selectHashtag=function(b,d){if(!(0>=d.length)&&f.selected){var a=b.selection.getRng();if(a.setStart)a.setStart(a.startContainer,a.startOffset-d.length);else if(a.parentElement&&a.getBoundingClientRect&&a.moveToPoint&&a.moveStart){var c=a.getBoundingClientRect();0==
c.left&&0==c.top&&(a.moveToElementText(a.parentElement()),c=a.getBoundingClientRect(),c.left=c.right,c.left+=0==a.boundingLeft?c.right-c.left:0,a.moveToPoint(c.left,c.top));a.moveStart("character",-1*d.length)}c={id:"mceHashtag"+(new Date).getTime(),tagName:b.dom.getAttrib(f.selected,"data-tagname")};b.selection.setRng(a);b.selection.setContent('<span contenteditable="false" class="mceItem mceHashtag mceNonEditable" id="'+c.id+'" data-mce-json="'+s.serialize(c,"'")+'">'+c.tagName+"</span>");b.nodeChanged();
this.hideHashtags()}};b.isHashtagSpan=function(b){return b&&"SPAN"===b.nodeName&&this.editor.dom.hasClass(b,"mceHashtag")};b.spanToObject=function(b,d){var a,c;(a=b.attr("data-mce-json"))&&!b.isEmpty()&&(a=s.parse(a),a.tagName&&(c=new q("#text",3),c.raw=!0,c.value="[tag:"+a.tagName+"]"));c?b.replace(c):b.remove()};b.resolveWhitespace=function(b){if(!b)return b;" "==b.substr(0,1)&&(b="&nbsp;"+b.substr(1));" "==b.substr(b.length-1)&&(b=b.substr(0,b.length-1)+"&nbsp;");return b};b.textToSpan=function(b){var d=
this,a=d.editor;if(b.parent){for(var c=new q("div"),f=/\[tag:([^\]]+)\]/g,k,h=0;k=f.exec(b.value);)(function(){var f={id:"mceHashtag"+l,tagName:k[1]};if(0<k.index)for(var m=a.parser.parse(d.resolveWhitespace(b.value.substr(h,k.index-h))).getAll("p"),p=0;p<m.length;p++)for(var w;null!=(w=m[p].walk());)c.append(w);m=new q("span",1);c.append(m);m.attr({id:f.id,"class":"mceItem mceHashtag mceNonEditable","data-mce-json":s.serialize(f,"'"),contenteditable:"false"});p=new q("#text",3);p.raw=!0;p.value=
tinymce.util.I18n.translate("???");m.append(p);d.getHashtagPreview(f,function(b){var d=a.dom.get(f.id);d&&(a.settings.evolution_hashtagsAllowed?d.innerHTML=b:(b=document.createTextNode("#"+b),a.dom.replace(b,d)))})})(),h=f.lastIndex,l++;if(0<h){if(h<b.value.length)for(var f=a.parser.parse(d.resolveWhitespace(b.value.substr(h))).getAll("p"),m=0;m<f.length;m++)for(var p;null!=(p=f[m].walk());)c.append(p);b.replace(c);c.unwrap()}}};b.getWindowScrollOffset=function(b){var d=0,a=0;"number"==typeof b.pageXOffset?
(d=b.pageXOffset,a=b.pageYOffset):b.document.body&&(b.document.body.scrollLeft||b.document.body.scrollTop)?(d=b.document.body.scrollLeft,a=b.document.body.scrollTop):b.document.documentElement&&(b.document.documentElement.scrollLeft||b.document.documentElement.scrollTop)&&(d=document.documentElement.scrollLeft,a=document.documentElement.scrollTop);return{x:d,y:a}};b.getHashtagPreview=function(b,d){b.tagName?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p",tagname:b.tagName}),success:function(b){b=
tinymce.util.JSON.parse(b);try{b&&b.html?0==b.html.indexOf("#")?d(b.html.substr(1)):d(b.html):d("")}catch(a){}},error:function(b){try{d("")}catch(a){}}}):d("")};b.searchForHashtags=function(b,d){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"s",query:b}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.hashtags?d(b,a.hashtags):d(b,null)}catch(c){}},error:function(a){try{d(b,null)}catch(c){}}})};b.getCallbackUrl=function(b){for(var d=this.url+"../../../apis/hashtags?",a={},c=this.editor.settings.evolution_contextQueryString.split(/&/g),
f=0;f<c.length;f++){var l=c[f].split(/=/);2==l.length&&(a[l[0]]=l[1])}for(var k in b)a[encodeURIComponent(k)]=encodeURIComponent(b[k]);b=!0;for(k in a)b?b=!1:d+="&",d+=k+"="+a[k];return d};c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(a){for(var d=a.length;d--;)b.textToSpan(a[d])});c.settings.evolution_hashtagsAllowed&&(c.serializer.addNodeFilter("span",function(a,d,c){d=a.length;for(var f;d--;)f=a[d],-1!==(f.attr("class")||"").indexOf("mceHashtag")&&b.spanToObject(f,c)}),c.on("keydown",
function(a){return b.handleKeyDown(c,a)},!0),c.on("keyup",function(a){return b.handleKeyUp(c,a)},!0),c.on("click",function(){b.hideHashtags()}))});c.settings.evolution_hashtagsAllowed&&(c.on("ResolveName",function(b){"span"===b.name&&c.dom.hasClass(b.target,"mceHashtag")&&(b.name=tinymce.util.I18n.translate("hashtag"))}),c.addMenuItem("removehashtag",{text:"Remove hashtag",cmd:"mceRemoveHashtag",stateSelector:"span.mceHashtag",context:"insert",prependToContext:!0,onPostRender:function(b){var d=function(){var d,
a;d=c.dom.getParent(c.selection.getStart(),function(b){return c.dom.hasClass(b,"mceHashtag")});a=c.dom.getParent(c.selection.getEnd(),function(b){return c.dom.hasClass(b,"mceHashtag")});d||a?b.control.show():b.control.hide()};d();c.on("NodeChange",function(){d()},!0)}}),c.addCommand("mceRemoveHashtag",function(){var a,d;d=c.selection.getNode();b.isHashtagSpan(d)&&(a=c.dom.getAttrib(d,"data-mce-json"))&&(a=s.parse(a));a&&(c.dom.setOuterHTML(d,d.innerHTML),c.nodeChanged())}),c.addButton("hashtagremove",
{text:"Remove",cmd:"mceRemoveHashtag"}),c.addContextToolbar(function(b){return c.dom.is(b,"span.mceHashtag")&&c.getBody().contains(b)},"hashtagremove"))});tinymce.PluginManager.add("media",function(c,u){var q=tinymce.html.Node,s=tinymce.util.JSON,m=0,a=this,k=!1;a.editor=c;a.url=u;a.isMediaSpan=function(a){return a&&"SPAN"===a.nodeName&&this.editor.dom.hasClass(a,"mceInsertMediaItem")};a.createData=function(a,c){var b=Math.round(0.8*jQuery(this.editor.getDoc()).width()),g=Math.round(0.8*jQuery(this.editor.getDoc()).height());
if(b>this.editor.settings.evolution_defaultMediaWidth||!c)b=this.editor.settings.evolution_defaultMediaWidth;if(g>this.editor.settings.evolution_defaultMediaHeight||!c)g=this.editor.settings.evolution_defaultMediaHeight;b>this.editor.settings.evolution_mediaMaxWidth&&0<this.editor.settings.evolution_mediaMaxWidth&&(b=this.editor.settings.evolution_mediaMaxWidth);g>this.editor.settings.evolution_mediaMaxHeight&&0<this.editor.settings.evolution_mediaMaxHeight&&(g=this.editor.settings.evolution_mediaMaxHeight);
return{id:"mceInsertMedia"+(new Date).getTime(),src:a,width:b,height:g}};a.openDialog=function(){function a(b){return/float:\s*left/i.test(b)?"float:left;":/float:\s*right/i.test(b)?"float:right;":""}function c(){var b=$(m.getEl());n.embedAsHtml&&n.html?($(".mcemedia-altcontainer, .mcemedia-alignmentcontainer",b).show(),$(".mcemedia-previewwrapper",b).height(q-($(".mcemedia-altcontainer",b).outerHeight()+$(".mcemedia-alignmentcontainer",b).outerHeight()))):($(".mcemedia-altcontainer, .mcemedia-alignmentcontainer",
b).hide(),$(".mcemedia-previewwrapper",b).css("height",""))}function b(){var b=$(m.getEl());$(".mcemedia-prev",b).hide();$(".mcemedia-prevloading",b).show();h.getPreview(n,function(d){try{d&&d.html&&0<d.html.length?(n.embedAsHtml=d.embedAsHtml,n.escapedSrc=d.url,n.html=d.html,c(),$(".mcemedia-prev",b).html(d.html)):n.src&&0<n.src.length?(n.embedAsHtml=!1,n.escapeSrc=null,n.html=null,c(),d&&d.error?$(".mcemedia-prev",b).text(d.error):$(".mcemedia-prev",b).text(tinymce.util.I18n.translate("No preview is available"))):
(n.embedAsHtml=!1,n.escapeSrc=null,n.html=null,c(),h.supportsUpload()&&h.supportsUrlEmbedding()?$(".mcemedia-prev",b).text(tinymce.util.I18n.translate("No file or URL is selected")):h.supportsUpload()?$(".mcemedia-prev",b).text(tinymce.util.I18n.translate("No file is selected")):$(".mcemedia-prev",b).text(tinymce.util.I18n.translate("No URL is selected"))),$(".mcemedia-prevloading",b).hide(),$(".mcemedia-prev",b).show(),d&&d.html&&0<d.html.length?(B=!0,$(".mce-primary button",b).prop("disabled",!1)):
(B=!1,$(".mce-primary button",b).prop("disabled",!0))}catch(a){}})}function g(b){var d=$(m.getEl());if(!b){n.width=isNaN(parseInt($(".mcemedia-width",d).val(),10))?0:parseInt($(".mcemedia-width",d).val(),10);n.height=isNaN(parseInt($(".mcemedia-height",d).val(),10))?0:parseInt($(".mcemedia-height",d).val(),10);var a=n.src;n.src=$(".mcemedia-url",d).val();n.cfsUrl&&(n.src=n.cfsUrl);if(a!=n.src)n.embedAsHtml=!1,n.escapedSrc=n.src,n.html="";else if(n.embedAsHtml&&(a=$(".mcemedia-prev img",d),0<a.length)){a.attr("alt",
$(".mcemedia-alt").val());var c=$(".mcemedia-alignment").val();""!=c?"float:right;"==c?(a.css("float","right"),a.attr("class","align-right")):"float:left;"==c?(a.css("float","left"),a.attr("class","align-left")):(a.css("float",""),a.attr("class",null)):(a.css("float",""),a.attr("class",null));n.html=$(".mcemedia-prev",d).html()}}$(".mcemedia-width",d).val(0<n.width?n.width:"");$(".mcemedia-height",d).val(0<n.height?n.height:"");b&&($(".mcemedia-alt",d).val(n.alt||""),$(".mcemedia-alignment",d).val(n.alignment||
""));b&&n.src&&(n.cfsUrl?$(".mcemedia-url",d).val(n.cfsUrl.substr(n.cfsUrl.lastIndexOf("/")+1)).attr("readonly","readonly"):$(".mcemedia-url",d).val(n.src).removeAttr("readonly"))}function d(){var d=$(m.getEl());B=!1;$(".mce-primary button",d).prop("disabled",!0);g(!1);b()}var n,k,h=this,m,p="Insert image/video/file",q;k=h.editor.selection.getNode();if(h.isMediaSpan(k)){if(n=h.editor.dom.getAttrib(k,"data-mce-json")){n=s.parse(n);var p=parseInt($(k).css("width"),10)||n.width,t=parseInt($(k).css("height"),
10)||n.height;if(t!=n.renderedHeight||p!=n.renderedWidth)n.height=t,n.width=p;p="Edit media"}}else if(k.src){var u=k.src,x=p=t=null;if(0==u.indexOf(window.location.origin)||"/"==u.substr(0,1))0<=u.indexOf("/resized-image/")&&/\/resized\-image(?:.ashx)?\/\_\_size\/([0-9]+)x([0-9]+)\/\_\_key\/(.*)/gi.exec(u)&&(u=$.telligent.evolution.site.getBaseUrl()+"cfs-file/__key/"+RegExp.$3,p=RegExp.$1,t=RegExp.$2),0<=u.indexOf("/cfs-file")&&(x=u);var A=$(k).width(),C=$(k).height(),p=h.editor.dom.getAttrib(k,"width")||
A||p,t=h.editor.dom.getAttrib(k,"height")||C||t;n={src:u,cfsUrl:x,width:p,height:t,alt:$(k).attr("alt")||"",alignment:a($(k).attr("style")||"")};p="Edit image"}n||(n=h.createData(h.editor.selection.getContent({format:"text"})));h.resize(n);var B=!1;k="";k=h.supportsUpload()&&h.supportsUrlEmbedding()?tinymce.util.I18n.translate("File or URL"):h.supportsUpload()?tinymce.util.I18n.translate("File"):tinymce.util.I18n.translate("URL");m=h.editor.windowManager.open({title:tinymce.util.I18n.translate(p),
body:[{type:"container",html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr><td><label for="file">'+k+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td><input id="file" name="file" type="text" value="" class="mce-textbox mcemedia-url" style="width: 260px" />\t\t<div><a href="#" id="file-upload" class="mcemedia-file">'+tinymce.util.I18n.translate("Upload")+'</a><a href="#" id="file-remove" class="mcemedia-clearfile">'+
tinymce.util.I18n.translate("Remove")+'</a><div></td>\t</tr>\t</table></td></tr><tr><td><label for="width">'+tinymce.util.I18n.translate("Dimensions")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>\t\t\t<td><input type="text" id="width" name="width" class="mce-textbox mcemedia-width" value="" size="3" /> '+tinymce.util.I18n.translate("x")+' <input class="mce-textbox mcemedia-height" type="text" id="height" name="height" value="" size="3" /></td>\t\t</tr>\t</table></td></tr><tr class="mcemedia-altcontainer" style="display: none;"><td><label for="alt">'+
tinymce.util.I18n.translate("Alternate Text")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>\t\t\t<td><input type="text" id="alt" name="alt" class="mce-textbox mcemedia-alt" value="" style="width: 260px;" /></td>\t\t</tr>\t</table></td></tr><tr class="mcemedia-alignmentcontainer" style="display: none;"><td><label for="alignment">'+tinymce.util.I18n.translate("Alignment")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>     <td><select id="alignment" name="alignment" class="mce-textbox mcemedia-alignment" style="width: 260px;">\t\t\t\t<option value="">'+
tinymce.util.I18n.translate("Inline with text")+'</option>\t\t\t\t<option value="float:left;">'+tinymce.util.I18n.translate("Left of text")+'</option>\t\t\t\t<option value="float:right;">'+tinymce.util.I18n.translate("Right of text")+'</option>\t\t\t</select></td>\t\t</tr>\t</table></td></tr></table><div class="mcemedia-previewwrapper"><div class="mcemedia-prevloading" style="display:none">'+tinymce.util.I18n.translate("Loading...")+'</div><div class="mcemedia-prev"></div></div>'}],buttons:[{text:"Ok",
onclick:function(){var b=$(m.getEl());n.src&&B&&(d(),h.editor.execCommand("mceRepaint"),n.embedAsHtml&&n.html?h.editor.selection.setContent(n.html):h.editor.selection.setNode(h.dataToSpan(n)),h.editor.nodeChanged(),$(".mcemedia-file",b).remove(),m.close())},subtype:"primary"},{text:"Cancel",onclick:function(){m.close()}}]});(function(){var a=$(m.getEl());q=$(".mcemedia-previewwrapper",a).innerHeight();$(".mce-primary button",a).prop("disabled",!0);g(!0);b();h.supportsUpload()?($(".mcemedia-clearfile",
a).on("click",function(){n.cfsUrl=null;$(".mcemedia-url",a).val("").removeAttr("readonly");d();b();$(".mcemedia-file",a).html(tinymce.util.I18n.translate("Upload"));$(".mcemedia-clearfile",a).hide();return!1}),$(".mcemedia-file",a).glowUpload({fileFilter:null,uploadUrl:h.getUploadUrl(),renderMode:"link",contentTypeId:h.editor.getParam("evolution_contenttypeid")||null,applicationTypeId:h.editor.getParam("evolution_applicationtypeid")||null,applicationId:h.editor.getParam("evolution_applicationid")||
null}).bind("glowUploadBegun",function(b){n.cfsUrl=null;$(".mcemedia-url",a).val("").removeAttr("readonly");$(".mcemedia-file",a).html(tinymce.util.I18n.translate("Uploading {0}%...").replace("{0}",0))}).bind("glowUploadComplete",function(c,g){$(".mcemedia-file",a).html("Upload");g&&0<g.name.length&&h.finalizeFileUpload(g.name,function(c){n.cfsUrl=c;$(".mcemedia-url",a).val(g.name).attr("readonly","readonly");d();b();$(".mcemedia-clearfile",a).show()})}).bind("glowUploadFileProgress",function(b,d){$(".mcemedia-file",
a).html(tinymce.util.I18n.translate("Uploading {0}%...").replace("{0}",d.percent))}).bind("glowUploadError",function(d){n.cfsUrl=null;$(".mcemedia-url",a).val("").removeAttr("readonly");$(".mcemedia-file",a).html(tinymce.util.I18n.translate("Upload"));$(".mcemedia-clearfile",a).hide();b()})):$(".mcemedia-file, .mcemedia-clearfile",a).hide();$(".mcemedia-url",a).on("change",function(){n.cfsUrl=null});$("input, select",a).on("change",function(){d()});n.cfsUrl||$(".mcemedia-clearfile",a).hide()})()};
a.getInfo=function(){return{longname:"Insert Media",author:"Telligent",authorurl:"http://telligent.com",version:"6.5"}};a.getFilename=function(a){var c=a.lastIndexOf("/");return 0<=c&&c<a.length?a.substr(c+1):a+""};a.dataToSpan=function(a,c){var b=this.editor,g;this.resize(a);g=this.editor.dom.create("span",{id:a.id,"class":"mceItem mceNonEditable mceInsertMediaItem","data-mce-json":s.serialize(a,"'"),style:"width:"+a.renderedWith+"px; height:"+a.renderedHeight+"px;",contenteditable:"false",spellcheck:"false"});
this.getMediaType(a,function(d,c,g,l,k){var h=b.dom.get(a.id);h&&(l&&$(h).css({"background-image":"url("+l+")"}).addClass("mceInsertMedaiWithPreview"),$(h).css({width:c+"px",height:g+"px"}).attr("title",k).addClass("mceInsertMediaItem"+d).html("<span>"+k+"</span>"),a.renderedWidth=c,a.renderedHeight=g)});return g};a.dataToHtml=function(a,c){return this.editor.serializer.serialize(this.dataToSpan(a,c),{forced_root_block:"",force_absolute:c})};a.htmlToData=function(a){var c,b;b={};if(c=this.editor.parser.parse(a).getAll("span")[0])if(b=
s.parse(c.attr("data-mce-json")),a=parseInt($(c).css("width"),10),c=parseInt($(c).css("height"),10),c!=b.renderedHeight||a!=b.renderedWidth)b.height=c,b.width=a;this.resize(b);return b};a.spanToObject=function(a,c){var b,g,d;if(b=a.attr("data-mce-json")){b=s.parse(b);for(var n=(a.attr("style")||"").split(";"),k=b.width,h=b.height,m=0;m<n.length;m++)d=n[m].split(":"),"width"==$.trim(d[0])?(d=parseInt(d[1],10))&&(k=d):"height"==$.trim(d[0])&&(d=parseInt(d[1],10))&&(h=d);if(h!=b.renderedHeight||k!=b.renderedWidth)b.height=
h,b.width=k,b.renderedHeight=null,b.renderedWidth=null;b.src&&(this.resize(b),g=new q("#text",3),g.raw=!0,g.value="[View:"+(b.escapedSrc?b.escapedSrc:b.src),g.value=0<b.width?g.value+(":"+b.width):g.value+":0",g.value=0<b.height?g.value+(":"+b.height):g.value+":0",g.value+="]");g?a.replace(g):a.remove()}};a.resizeCfsImg=function(a,c){var b=a.attr("src"),g=a.attr("width")||0,d=a.attr("height")||0;0!=b.indexOf(window.location.origin)&&"/"!=b.substr(0,1)||(0==g||0==d)||/\/resized\-image\/\_\_size\/([0-9]+)x([0-9]+)\/\_\_key\/(.*)/gi.exec(b)&&
(RegExp.$1!=g&&RegExp.$2!=d)&&a.attr({width:null,height:null,src:"/resized-image/__size/"+g+"x"+d+"/__key/"+RegExp.$3,"data-mce-src":"/resized-image/__size/"+g+"x"+d+"/__key/"+RegExp.$3})};a.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};a.textToSpan=function(a){var c=this,b=c.editor;if(a.parent){for(var g=new q("div"),d=/\[view:([^\]]+?)(?:\:([0-9]+)(?:\:([0-9]+))?)?\]/gi,n,k=0;n=d.exec(a.value);)(function(){var d=
RegExp.$1,h=RegExp.$2||0,p=RegExp.$3||0,w={id:"mceInsertMedia"+m++,src:d,width:h,height:p};c.resize(w);if(0<n.index)for(d=b.parser.parse(c.resolveWhitespace(a.value.substr(k,n.index-k))).getAll("p"),h=0;h<d.length;h++)for(;null!=(p=d[h].walk());)g.append(p);b.settings.evolution_mediaAllowed?(d=new q("span",1),g.append(d),d.attr({id:w.id,"class":"mceItem mceNonEditable mceInsertMediaItem",style:"width: "+w.renderedWidth+"px; height:"+w.renderedHeight+"px;","data-mce-json":s.serialize(w,"'"),contenteditable:"false",
spellcheck:"false"}),c.getMediaType(w,function(d,a,c,g,f){var l=b.dom.get(w.id);l&&(g&&$(l).css({"background-image":"url("+g+")"}).addClass("mceInsertMedaiWithPreview"),$(l).css({width:a+"px",height:c+"px"}).attr("title",f).addClass("mceInsertMediaItem"+d).html("<span>"+f+"</span>"),w.renderedWidth=a,w.renderedHeight=c)})):(d=new q("a",1),d.attr({href:w.src}),h=new q("#text",3),h.raw=!0,h.value=w.src,d.append(h),g.append(d))})(),k=d.lastIndex;if(0<k){if(k<a.value.length)for(var d=b.parser.parse(c.resolveWhitespace(a.value.substr(k))).getAll("p"),
h=0;h<d.length;h++)for(var p;null!=(p=d[h].walk());)g.append(p);a.replace(g);g.unwrap()}}};a.getCallbackUrl=function(a){for(var c=this.url+"../../../apis/media?",b={},g=this.editor.settings.evolution_contextQueryString.split(/&/g),d=0;d<g.length;d++){var n=g[d].split(/=/);2==n.length&&(b[n[0]]=n[1])}for(var k in a)b[encodeURIComponent(k)]=encodeURIComponent(a[k]);a=!0;for(k in b)a?a=!1:c+="&",c+=k+"="+b[k];return c};a.getPreview=function(a,c){var b=this;a.src&&0!=a.src.length?tinymce.util.XHR.send({url:b.getCallbackUrl({t:"gp",
url:a.src,width:a.width,height:a.height,contentTypeId:b.editor.getParam("evolution_contenttypeid")||""}),success:function(b){b=tinymce.util.JSON.parse(b);try{b&&b.html?c(b):b&&b.error?c(b):c("")}catch(d){}},error:function(a){b.editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while attempting to preview the file."));try{c("")}catch(d){}}}):c("")};a.getMediaType=function(a,c){var b=this;a.src&&0!=a.src.length?tinymce.util.XHR.send({url:b.getCallbackUrl({t:"gmt",url:a.src,width:a.width,
height:a.height}),success:function(g){g=tinymce.util.JSON.parse(g);try{g&&g.type?c(g.type,g.width,g.height,g.url,g.label):c("Empty",a.width,a.height,null,b.getFilename(a.src))}catch(d){}},error:function(g){try{c("Empty",a.width,a.height,null,b.getFilename(a.src))}catch(d){}}}):c("Empty",a.width,a.height,null,"")};a.getUploadUrl=function(){return a.editor.settings.evolution_directUploadUrl};a.finalizeFileUpload=function(a,c){a&&0!=a.length?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"fu",file:a,
uploadContext:this.editor.settings.evolution_directUploadContext}),success:function(b){b=tinymce.util.JSON.parse(b);try{b&&b.url?c(b.url):(b&&b.error&&alert(b.error),c(""))}catch(a){}},error:function(b){alert(tinymce.util.I18n.translate("An error occurred while uploading the file."));try{c("")}catch(a){}}}):c("")};a.supportsUpload=function(){return!0===c.getParam("evolution_upload")};a.supportsUrlEmbedding=function(){return!0===c.getParam("evolution_urlembed")};a.resize=function(c){c.width>a.editor.settings.evolution_mediaMaxWidth&&
0<a.editor.settings.evolution_mediaMaxWidth&&(c.width=a.editor.settings.evolution_mediaMaxWidth);c.height>a.editor.settings.evolution_mediaMaxHeight&&0<a.editor.settings.evolution_mediaMaxHeight&&(c.height=a.editor.settings.evolution_mediaMaxHeight);c.renderedWidth&&0!=c.renderedWidth||(c.renderedWidth=!c.width||0>=c.width?0<c.height?Math.round(4*c.height/3):0<a.editor.settings.evolution_mediaMaxWidth?a.editor.settings.evolution_mediaMaxWidth:a.editor.settings.evolution_defaultMediaWidth:c.width,
c.renderedWidth>a.editor.settings.evolution_mediaMaxWidth&&0<a.editor.settings.evolution_mediaMaxWidth&&(c.renderedWidth=a.editor.settings.evolution_mediaMaxWidth));c.renderedHeight&&0!=c.renderedHeight||(c.renderedHeight=!c.height||0>=c.height?0<a.editor.settings.evolution_mediaMaxHeight?a.editor.settings.evolution_mediaMaxHeight:Math.round(3*c.renderedWidth/4):c.height,c.renderedHeight>a.editor.settings.evolution_mediaMaxHeight&&0<a.editor.settings.evolution_mediaMaxHeight&&(c.renderedHeight=a.editor.settings.evolution_mediaMaxHeight))};
a.initializeDirectUpload=function(c){var l=null;jQuery("#"+c.id).glowUpload({fileFilter:null,renderMode:"link",uploadUrl:a.getUploadUrl(),contentTypeId:a.editor.getParam("evolution_contenttypeid")||null,applicationTypeId:a.editor.getParam("evolution_applicationtypeid")||null,applicationId:a.editor.getParam("evolution_applicationid")||null}).on("glowUploadError",function(){a.hideShade();editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while uploading a file."));e.preventDefault();
e.stopImmediatePropagation();e.stopPropagation()}).on("glowUploadFileProgress",function(b,c){a.showShade(tinymce.util.I18n.translate("Uploading '{0}' ({1}%)...").replace("{0}",c.name).replace("{1}",c.percent));b.preventDefault();b.stopImmediatePropagation();b.stopPropagation()}).on("glowUploadComplete",function(b,c){a.hideShade();b.preventDefault();b.stopImmediatePropagation();b.stopPropagation();a.finalizeFileUpload(jQuery(this).glowUpload("val").name,function(b){var c={};c.id="mceInsertMedia"+(new Date).getTime();
c.type="url";c.width=a.editor.settings.evolution_defaultMediaWidth;c.height=a.editor.settings.evolution_defaultMediaHeight;c.src=b;c.embedAsHtml=!1;c.escapedSrc=c.src;c.html="";a.getPreview(c,function(b){try{b&&(b.html&&0<b.html.length)&&(b&&b.html&&0<b.html.length)&&(c.embedAsHtml=b.embedAsHtml,c.escapedSrc=b.url,c.html=b.html,a.editor.execCommand("mceRepaint"),l&&(a.editor.selection.moveToBookmark(l),l=null),c.embedAsHtml&&c.html?a.editor.selection.setContent(c.html):a.editor.selection.setNode(a.dataToSpan(c)))}catch(d){}})})}).on("click",
function(){l=a.editor.selection.getBookmark();return!0})};a.showShade=function(c){clearTimeout(a.hideTimeout);var l=jQuery(a.editor.getContentAreaContainer()).width();c?a.shadeMessage.text(c).css({display:"block",width:l+"px"}):a.shadeMessage.css("display","none");a.shade.height(jQuery(a.editor.getContainer()).height()).width(l).css("display","block")};a.hideShade=function(){clearTimeout(a.hideTimeout);a.hideTimeout=setTimeout(function(){a.shade.css("display","none");a.shadeMessage.css("display",
"none");a.dragCount=0},100)};a.nodeContainsContent=function(a){for(var c=0;c<a.children.length;c++)if("SPAN"==a.children[c].nodeName)return!0;return!1};c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(c){for(var l=c.length;l--;)a.textToSpan(c[l])});c.settings.evolution_mediaAllowed&&c.serializer.addNodeFilter("span",function(c,l,b){l=c.length;var g;if(!b||!b.selection)for(;l--;)g=c[l],-1!==(g.attr("class")||"").indexOf("mceInsertMediaItem")?a.spanToObject(g,b):-1!==(g.attr("src")||
"").indexOf("/__key/")&&a.resizeCfsImg(g,b)})});if(c.settings.evolution_mediaAllowed){c.on("init",function(){var f=jQuery("<div></div>").css({position:"absolute",top:"0px",left:"0px"});jQuery(c.getContainer()).append(f);a.shade=jQuery('<div class="mceDragDropShade"></div>').css({position:"absolute",display:"none",left:"0px",top:"0px"});a.shadeMessage=jQuery('<div class="mceDragDropMessage"></div>').css({position:"absolute",display:"none",left:"0px",top:"0px"});f.append(a.shade).append(a.shadeMessage);
!a.supportsUpload()||(k||!jQuery.fn.glowUpload||tinymce.isIE6||tinymce.isIE7||tinymce.isIE8||tinymce.isIE9)||(c.plugins.tips&&c.plugins.tips.defaultTip&&c.plugins.tips.defaultTip(tinymce.util.I18n.translate("Add images and other files by dragging them into the editor.")),k=!0,a.dragCount=0,jQuery(c.getBody()).on("dragenter",function(c){c=c.originalEvent.dataTransfer;c.types&&(c.types.indexOf?-1!=c.types.indexOf("Files"):c.types.contains("Files"))&&(a.showShade(tinymce.util.I18n.translate("Upload file(s)")),
0>a.dragCount&&(a.dragCount=0))}),jQuery(c.getBody()).parent().on("dragenter",function(c){c=c.originalEvent.dataTransfer;c.types&&(c.types.indexOf?-1!=c.types.indexOf("Files"):c.types.contains("Files"))&&(a.showShade(tinymce.util.I18n.translate("Upload file(s)")),0>a.dragCount&&(a.dragCount=0))}),jQuery(c.getContainer()).on("dragenter",function(c){c=c.originalEvent.dataTransfer;c.types&&(c.types.indexOf?-1!=c.types.indexOf("Files"):c.types.contains("Files"))&&(a.showShade(tinymce.util.I18n.translate("Upload file(s)")),
0>a.dragCount&&(a.dragCount=0))}),a.shadeMessage.on("dragenter",function(){a.dragCount++;clearTimeout(a.hideTimeout)}),a.shadeMessage.on("dragleave",function(){a.dragCount--;0>=a.dragCount&&a.hideShade()}),a.shade.on("dragenter",function(){a.dragCount++;clearTimeout(a.hideTimeout)}),a.shade.on("dragleave",function(c){a.dragCount--;0>=a.dragCount&&a.hideShade()}),jQuery(c.getContainer()).glowUpload({fileFilter:null,renderMode:"dragdrop",uploadUrl:a.getUploadUrl(),contentTypeId:a.editor.getParam("evolution_contenttypeid")||
null,applicationTypeId:a.editor.getParam("evolution_applicationtypeid")||null,applicationId:a.editor.getParam("evolution_applicationid")||null}).on("glowUploadError",function(){a.hideShade();editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while uploading a file."))}).on("glowUploadFileProgress",function(c,b){a.showShade(tinymce.util.I18n.translate("Uploading '{0}' ({1}%)...").replace("{0}",b.name).replace("{1}",b.percent))}).on("glowUploadComplete",function(f,b){a.hideShade();
a.finalizeFileUpload(b.name,function(b){var d={};d.id="mceInsertMedia"+(new Date).getTime();d.type="url";d.width=a.editor.settings.evolution_defaultMediaWidth;d.height=a.editor.settings.evolution_defaultMediaHeight;d.src=b;d.embedAsHtml=!1;d.escapedSrc=d.src;d.html="";a.getPreview(d,function(b){try{b&&(b.html&&0<b.html.length)&&(b&&b.html&&0<b.html.length)&&(d.embedAsHtml=b.embedAsHtml,d.escapedSrc=b.url,d.html=b.html,c.execCommand("mceRepaint"),d.embedAsHtml&&d.html?c.selection.setContent(d.html):
c.selection.setNode(a.dataToSpan(d)))}catch(g){}})})}));a.editor.on("dblclick",function(f){if(c.dom.hasClass(f.target,"mceInsertMediaItem"))a.openDialog(f.target);else if(c.dom.hasClass(f.target.parentNode,"mceInsertMediaItem"))a.openDialog(f.target.parentNode);else if("IMG"==f.target.nodeName&&f.target.src&&(!f.target.className||0>f.target.className.indexOf("mce"))){for(var b=f.target.parentNode;b&&"BODY"!=b.nodeName;){if(b.className&&0<=b.className.indexOf("mce"))return;b=b.parentNode}a.openDialog(f.target)}});
a.editor.on("NodeChange",function(){var f=c.selection.getNode();"A"==f.nodeName&&f.href&&!a.nodeContainsContent(f)?a.editor.execCommand("mceTip",!1,tinymce.util.I18n.translate("Select 'Convert link to preview' from the 'Edit' menu to preview this link.")):c.dom.hasClass(f,"mceInsertMediaItem")&&a.editor.execCommand("mceTip",!1,tinymce.util.I18n.translate("Select 'Convert preview to link' from the 'Edit' menu to just show a link to this file/site."))},!0)});c.on("ObjectResized",function(a){if("IMG"==
a.target.nodeName){var c=$(a.target),b=parseInt(c.css("max-width"),10);isNaN(b)||b==a.width||c.css("max-width",a.width+"px");b=parseInt(c.css("width"),10);isNaN(b)||b==a.width||c.attr("width",b);b=parseInt(c.css("max-height"),10);isNaN(b)||b==a.height||c.css("max-height",a.height+"px");b=parseInt(c.css("height"),10);isNaN(b)||b==a.height||c.css("height",a.height+"px");b=c.attr("src");0<=b.indexOf("/resized-image")&&/\/resized\-image(?:.ashx)?\/\_\_size\/([0-9]+)x([0-9]+)\/\_\_key\/(.*)/i.exec(b)&&
(b=$.telligent.evolution.site.getBaseUrl()+"resized-image/__size/"+2*a.width+"x"+2*a.height+"/__key/"+RegExp.$3,c.attr("src",b).removeAttr("data-mce-src"));c.removeAttr("data-mce-style")}});var p=!1,h=null;c.on("init",function(){jQuery(c.getBody()).on("mousedown",function(a){1==a.buttons%2&&(window.clearTimeout(h),p=!0)}).on("mouseup mouseleave",function(a){p&&(window.clearTimeout(h),h=window.setTimeout(function(){p=!1},10))})});c.on("PastePreProcess",function(f){function k(b,d,a){var c=new XMLHttpRequest;
c.open("GET",b,!0);c.responseType="blob";c.onreadystatechange=function(b){4==this.readyState&&(200==this.status&&"blob"==this.responseType?d(new Blob([this.response],{type:this.getResponseHeader("Content-Type")})):a())};c.send()}function b(b,d,c,g){if("image/"!=b.type.substr(0,6))g();else{var f=b.type.substr(6);if("png"!=f&&"gif"!=f&&"jpg"!=f&&"jpeg"!=f&&"pjpeg"!=f)g();else{"pjpeg"==f&&(f="jpeg");var n=Math.ceil(b.size/1048576),k=[],l;for(l=0;l<n;l++)(function(){var c=new FormData;c.append("File",
b.slice(1048576*l,Math.min(b.size,1048576*(l+1)),"image/"+f),d+"."+f);c.append("FileName",d+"."+f);c.append("TotalChunks",n);c.append("CurrentChunk",l);c.append("UploadContextId",a.editor.settings.evolution_directUploadContext);k.push(jQuery.telligent.evolution.post({url:jQuery.telligent.evolution.site.getBaseUrl()+"api.ashx/v2/cfs/temporary.json",data:c,contentType:!1,processData:!1}))})();jQuery.when.apply(jQuery,k).then(function(b){b&&b.UploadedFile&&b.UploadedFile.DownloadUrl?c(b.UploadedFile.DownloadUrl):
g()})["catch"](function(){g()})}}}function g(d,a,c,g){var f,n,k,l;d=d.split(/[:;,]/g,4);if("data"!=d[0]||"base64"!=d[2])g();else if("image"!=d[1].substr(0,5))g();else{var h=d[1].substr(6);if("png"!=h&&"gif"!=h&&"jpg"!=h&&"jpeg"!=h&&"pjpeg"!=h)g();else{"pjpeg"==h&&(h="jpeg");try{n=window.atob(d[3]);k=[];for(f=0;f<n.length;f++)k.push(n.charCodeAt(f));l=new Blob([new Uint8Array(k)],{type:"image/"+h});b(l,a,c,g)}catch(m){g()}}}}function d(d,c,f,n){"data:"==d.substr(0,5)?g(d,c,f,n):k(d,function(d){b(d,
c,function(b){f(b)},function(){n()})},function(){tinymce.util.XHR.send({url:a.getCallbackUrl({t:"si",url:d,fileName:c,uploadContext:a.editor.settings.evolution_directUploadContext}),success:function(b){b=tinymce.util.JSON.parse(b);try{b&&b.url?f(b.url):n()}catch(d){n()}},error:function(b){n()}})})}function n(b,g,f,n){if(!(a.supportsUpload()&&window.FormData&&window.Blob&&window.Uint8Array&&window.atob&&window.jQuery&&jQuery.telligent&&jQuery.telligent.evolution&&jQuery.telligent.evolution.post))return"";
var k="pastedimage"+(new Date).getTime()+"v"+ ++m;d(g,k,function(b){var d=c.dom.get(k);if(d){var g={};g.id="mceInsertMedia"+k;g.type="url";g.width=f;g.height=n;g.src=b;g.embedAsHtml=!1;g.escapedSrc=g.src;g.html="";a.getPreview(g,function(b){try{b&&(b.html&&0<b.html.length)&&(b&&b.html&&0<b.html.length)&&(g.embedAsHtml=b.embedAsHtml,g.escapedSrc=b.url,g.html=b.html,g.embedAsHtml&&g.html?c.dom.setOuterHTML(d,g.html):c.dom.replace(a.dataToSpan(g),d))}catch(f){}})}},function(){window.setTimeout(function(){c.dom.remove(k)},
250)});return'<span id="'+k+'" contenteditable="false" class="mceItem mceNonEditable mceInsertMediaItem mceInsertMediaItem mceInsertMediaItemImage" style="width: '+f+"px; height: "+n+'px; color: Transparent;">...</span>'}if(!p){var h=/<(img)\s[^>]*?src="([^"]*)"[^>]*>/gi,s=/width=\"?(\d+)\"?/i,q=/style=\"?[^ "]*?width:\s*(\d+)px/i,u=/height=\"?(\d+)\"?/i,v=/style=\"?[^ "]*?height:\s*(\d+)px/i,t=null;try{t=RegExp("^(?:"+$.telligent.evolution.regex.encode($.telligent.evolution.site.getBaseUrl(!1))+
"|"+$.telligent.evolution.regex.encode($.telligent.evolution.site.getBaseUrl(!0))+")(?:resized-image|cfs-file)(?:.ashx)?","")}catch(E){t=null}var x,A=0,C="",B,D,G,H;if(0===f.content.indexOf("data:image/"))f.content=n("img",f.content,a.editor.settings.evolution_defaultMediaWidth,a.editor.settings.evolution_defaultMediaHeight);else{for(;x=h.exec(f.content);){x.index>A&&(C+=f.content.substr(A,x.index-A));G=x[1];H=x[2];if("img"==G.toLowerCase()&&null!=t&&t.test(H))C+=x[0];else{A=NaN;if(D=s.exec(x[0]))A=
parseInt(D[1],10);isNaN(A)&&(D=q.exec(x[0]))&&(A=parseInt(D[1],10));isNaN(A)&&(A=a.editor.settings.evolution_defaultMediaWidth);B=NaN;if(D=u.exec(x[0]))B=parseInt(D[1],10);isNaN(B)&&(D=v.exec(x[0]))&&(B=parseInt(D[1],10));isNaN(B)&&(B=a.editor.settings.evolution_defaultMediaHeight);C+=n(G,H,A,B)}A=h.lastIndex}A<f.content.length&&(C+=f.content.substr(A));f.content=C}}});c.on("ResolveName",function(a){"span"===a.name&&c.dom.hasClass(a.target,"mceInsertMediaItem")&&(a.name=tinymce.util.I18n.translate("media"))});
c.on("NodeChange",function(){var a=c.selection.getNode();c.dom.hasClass(a,"mceInsertMediaItem")&&window.setTimeout(function(){c.selection.controlSelection.showResizeRect(a)},2)});c.addCommand("mceInsertMedia",function(){a.openDialog()});c.addCommand("mceRemoveMedia",function(){c.dom.remove(c.selection.getNode())});c.addCommand("mceInsertMediaToPreview",function(){var f=c.selection.getNode();if("A"!=f.nodeName)for(var k=0;k<f.childNodes.length;k++)if("A"==f.childNodes[k].nodeName&&f.childNodes[k].href){f=
f.childNodes[k];break}if("A"==f.nodeName){var b=a.createData(f.href,!0);b.renderedWidth=b.width;b.renderedHeight=b.height;a.getPreview(b,function(g){try{g&&(g.html&&0<g.html.length)&&(b.embedAsHtml=g.embedAsHtml,b.escapedSrc=g.url,b.html=g.html),b.embedAsHtml?$(f).replaceWith(b.html):c.dom.replace(a.dataToSpan(b),f,!1)}catch(d){}})}});c.addCommand("mceInsertMediaToLink",function(){var f,k,b;k=c.selection.getNode();a.isMediaSpan(k)?(f=c.dom.getAttrib(k,"data-mce-json"))&&(f=s.parse(f)):"IMG"==k.nodeName&&
k.src&&(f={src:k.src});f&&(b=document.createElement("a"),b.href=f.src,b.innerHTML=f.src,c.dom.replace(b,k,!1))});c.addMenuItem("media",{text:"Insert image/video/file",icon:"media",cmd:"mceInsertMedia",context:"insert",prependToContext:!0});c.addMenuItem("convertmediatolink",{text:"Convert to link",cmd:"mceInsertMediaToLink",icon:"link",context:"edit",prependToContext:!0,onPostRender:function(a){var k=function(){var b=c.selection.getNode();b&&c.dom.hasClass(b,"mceInsertMediaItem")?a.control.show():
a.control.hide()};k();c.on("NodeChange",function(){k()},!0)}});c.addMenuItem("removemedia",{text:"Remove media",cmd:"mceRemoveMedia",context:"edit",prependToContext:!0,onPostRender:function(a){var k=function(){var b=c.selection.getNode();b&&c.dom.hasClass(b,"mceInsertMediaItem")?a.control.show():a.control.hide()};k();c.on("NodeChange",function(){k()},!0)}});c.addMenuItem("previewmedia",{text:"Convert to preview",cmd:"mceInsertMediaToPreview",icon:"media",context:"edit",prependToContext:!0,onPostRender:function(f){var k=
function(){var b=c.selection.getNode();b&&"A"==b.nodeName&&b.href&&!a.nodeContainsContent(b)?f.control.show():f.control.hide()};k();c.on("NodeChange",function(){k()},!0)}});c.addMenuItem("editmedia",{text:"Edit media",icon:"media",cmd:"mceInsertMedia",context:"edit",prependToContext:!0,onPostRender:function(a){var k=function(){var b=c.selection.getNode();b&&c.dom.hasClass(b,"mceInsertMediaItem")?a.control.show():a.control.hide()};k();c.on("NodeChange",function(){k()},!0)}});c.addMenuItem("editimage",
{text:"Edit image",icon:"image",cmd:"mceInsertMedia",context:"edit",prependToContext:!0,onPostRender:function(a){var k=function(){var b=c.selection.getNode();b&&"IMG"==b.nodeName&&b.src&&(!b.className||0>b.className.indexOf("mce"))?a.control.show():a.control.hide()};k();c.on("NodeChange",function(){k()},!0)}});c.addButton("insertmediadirect",{title:"Insert image/video/file",cmd:"mceInsertMediaIgnore",icon:"image",onPostRender:function(c){a.supportsUpload()&&jQuery.fn.glowUpload?a.initializeDirectUpload(c.control.getEl()):
c.control.hide()}});c.settings.evolution_mobile||c.addButton("editmedia",{text:"Edit",cmd:"mceInsertMedia"});c.addButton("removemedia",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode());c.nodeChanged()}});c.addButton("convertmediatolink",{text:"Convert to link",cmd:"mceInsertMediaToLink"});c.addContextToolbar(function(a){if(c.dom.hasClass(a,"mceInsertMediaItem"))return!0;if("IMG"==a.nodeName&&a.src&&(!a.className||0>a.className.indexOf("mce"))){for(a=a.parentNode;a&&"BODY"!=a.nodeName;){if(a.className&&
0<=a.className.indexOf("mce"))return!1;a=a.parentNode}return!0}return!1},"editmedia removemedia convertmediatolink")}});tinymce.PluginManager.add("mentions",function(c,u){var q=tinymce.html.Node,s=tinymce.util.JSON,m=!1,a=!1,k,p,h={container:null,categories:null,mentionables:null},f=1,l=this;l.editor=c;l.url=u;l.handleKeyDown=function(b,c){if(!this.disabledState&&m){if(40==c.keyCode||38==c.keyCode||39==c.keyCode||37==c.keyCode)return this.moveHighlightedMention(c.keyCode,null),this.cancelEvent(c);
if(13==c.keyCode||9==c.keyCode)return this.selectMentionable(b,this.getCurrentWord(b)),a=!1,this.cancelEvent(c);if(27==c.keyCode)return a=!1,this.hideMentionables(),this.cancelEvent(c)}else if(13==c.keyCode||9==c.keyCode||27==c.keyCode){var d=b.selection.getSel();if(d&&d.focusNode&&(d=$(d.focusNode).is(".mceMention")?$(d.focusNode):$(d.focusNode).closest(".mceMention"),0<d.length))return l.escapeMention(b,d[0]),this.cancelEvent(c)}};l.escapeMention=function(b,a){for(var d=a.nextSibling;d&&3==d.nodeType&&
0==d.length;)d=d.nextSibling;null==d&&(d=$('<span data-mce-bogus="1">&nbsp;</span>'),$(a).after(d),d=d[0].childNodes[0]);b.selection.select(d,!0);b.selection.collapse(!0);b.selection.getRng().setStart(d,1)};l.cancelEvent=function(b){b.preventDefault();b.stopImmediatePropagation();b.stopPropagation();return!1};l.getLastTypedCharacter=function(b,a){var d=b.getDoc(),c=b.selection.getSel();if(c.focusNode&&c.focusOffset){if(d=c.focusNode.nodeValue,0<=c.focusOffset-1&&d&&d.length>=c.focusOffset)return d.charAt(c.focusOffset-
1)}else if(d.selection&&d.selection.createRange){c=d.selection.createRange();if(!(c.parentElement&&c.moveToPoint&&c.moveStart&&c.getBoundingClientRect))return"";if(null!=c.parentElement())try{c.parentElement().focus()}catch(f){}c=d.selection.createRange();d=c.getBoundingClientRect();0==d.left&&0==d.top&&(c.moveToElementText(c.parentElement()),d=c.getBoundingClientRect(),d.left=d.right);d.left+=0==c.boundingLeft?d.right-d.left:0;d.top=(d.bottom+d.top)/2;c.moveToPoint(d.left,d.top);c.moveStart("character",
-1);return c.text}return""};l.handleKeyUp=function(b,c){if(!this.disabledState){var d=this.getLastTypedCharacter(b,c);(m||a||"@"==d)&&(40!=c.keyCode&&38!=c.keyCode&&13!=c.keyCode&&27!=c.keyCode&&39!=c.keyCode&&37!=c.keyCode)&&(d=this.getCurrentWord(b),a||(k=!0,p=""),256<d.length||""==d?(a=!1,this.hideMentionables()):(a=!0,0<d.length&&(k||d.length-1<=p.length||d.substr(1,p.length)!=p)?(m=!0,this.showMentionables(b,d.substr(1))):this.hideMentionables()))}};l.moveHighlightedMention=function(b,a){var d;
if(a)h.mentionables.find("li.mceMentionablesSelected").removeClass("mceMentionablesSelected"),$(a).addClass("mceMentionablesSelected");else if(37==b){if(d=h.categories.glowTabSet("selected"))d=parseInt(d.id,10),!isNaN(d)&&0<d?h.categories.glowTabSet("selected",h.categories.glowTabSet("getById",d-1)):h.categories.glowTabSet("selected",h.categories.glowTabSet("getById",h.categories.glowTabSet("count")-1))}else if(39==b){if(d=h.categories.glowTabSet("selected"))d=parseInt(h.categories.glowTabSet("selected").id,
10),!isNaN(d)&&d<h.categories.glowTabSet("count")-1?h.categories.glowTabSet("selected",h.categories.glowTabSet("getById",d+1)):h.categories.glowTabSet("selected",h.categories.glowTabSet("getById",0))}else 40==b?(d=h.mentionables.find("li.mceMentionablesSelected"),0<d.length&&0<d.next().length?l.scrollMentionableIntoView(d.removeClass("mceMentionablesSelected").next().addClass("mceMentionablesSelected"),!1):(d.removeClass("mceMentionablesSelected"),l.scrollMentionableIntoView(h.mentionables.find("li:first").addClass("mceMentionablesSelected"),
!0))):38==b&&(d=h.mentionables.find("li.mceMentionablesSelected"),0<d.length&&0<d.prev().length?l.scrollMentionableIntoView(d.removeClass("mceMentionablesSelected").prev().addClass("mceMentionablesSelected"),!0):(d.removeClass("mceMentionablesSelected"),l.scrollMentionableIntoView(h.mentionables.find("li:last").addClass("mceMentionablesSelected"),!1)))};l.scrollMentionableIntoView=function(b,a){if(0!=b.length){var d=b.position(),c=b.outerHeight(),f=b.offsetParent(),k=f.scrollTop(),h=f.height();a?
0>d.top&&f.scrollTop(k+d.top):d.top+c>h&&f.scrollTop(k+d.top+c-h)}};l.showCategoryMentionables=function(b,a){var d=this,c=$("<ul></ul>");h.mentionables.html(c);$.each(a,function(a,g){var f=$("<li></li>");f.css({cursor:"pointer"});var k=$('<div class="mceMentionablePreview"></div>').html(g.previewhtml);f.append(k);g.detail&&0<g.detail.length&&(k=$('<div class="mceMentionableDetail"></div>').html(g.detail),f.append(k));f.data("mention",{contentid:g.contentid,contenttypeid:g.contenttypeid,supportslabelhtml:g.supportslabelhtml,
detail:g.detail,url:g.url,defaulthtml:g.defaulthtml});f.on("click",function(){d.moveHighlightedMention(null,f);b.selection.moveToBookmark(h.bookmark);d.selectMentionable(b,d.getCurrentWord(b));return!1});f.on("mouseover",function(){d.moveHighlightedMention(null,f)});c.append(f)});c.find("li:first").addClass("mceMentionablesSelected")};l.showMentionables=function(b,a){var d=this;h.container||(h.container=$("<div></div>"),h.container.addClass("mceMentionablesList"),h.container.css({position:"absolute",
"z-index":"200001",width:Math.max($(window).width()/3,300)+"px"}),$("body").append(h.container),h.categories=$("<div></div>"),h.container.append(h.categories),h.categories.glowTabSet({cssClass:"mceMentionableCategoryList",tabCssClasses:["mceMentionableCategory"],tabSelectedCssClasses:["mceMentionableCategory mceMentionableCategorySelected"],tabHoverCssClasses:["mceMentionableCategory"],enableResizing:!1,tabs:[]}),h.mentionables=$("<div></div>"),h.mentionables.addClass("mceMentionables"),h.mentionables.css({position:"relative"}),
h.container.append(h.mentionables));h.container.css({display:"block"});h.categories.glowTabSet("clear");h.categories.glowTabSet("refresh");h.mentionables.html('<span class="ui-loading"></span>');var c=this.getWindowScrollOffset(window),f=b.dom.getPos(b.getContentAreaContainer()),l=this.getWindowScrollOffset(b.getWin()),m=b.dom.getPos(b.selection.getNode()),s=0,q=0,q=b.selection.getRng(),t=null;0==q.getClientRects().length?q.parentElement&&q.getBoundingClientRect&&q.moveToPoint&&q.moveStart?(q.moveToElementText(q.parentElement()),
t=q.getBoundingClientRect(),t.left=t.right,t.left+=0==q.boundingLeft?t.right-t.left:0,q.moveToPoint(t.left,t.top),q.moveStart("character",-1),t=q.getClientRects()[0]):q.insertNode&&(s=b.getWin().document.createElement("span"),q.insertNode(s),t=b.dom.getPos(s),t={left:t.x,top:t.y,width:0,height:s.offsetHeight},s.parentNode.removeChild(s)):t=q.getClientRects()[0];t&&(!t.width&&!t.height&&t.right&&t.bottom)&&(t={width:t.right-t.left,height:t.bottom-t.top,left:t.left-f.x,top:t.top-f.y});t?(s=t.top+t.height,
q=t.left):(s=1.3*parseInt(b.dom.getStyle(b.selection.getNode(),"font-size",!0))+m.y,q=m.x);s+f.y>$(window).height()/2?h.container.css({bottom:$("body").outerHeight()-(f.y+c.y+s-l.y)+t.height+"px",left:f.x+c.x+q-l.x+"px",top:"auto"}):h.container.css({top:f.y+c.y+s-l.y+"px",left:f.x+c.x+q-l.x+"px",bottom:"auto"});h.lastSearchText=a;window.clearTimeout(h.searchHandle);h.bookmark=b.selection.getBookmark(2);h.searchHandle=window.setTimeout(function(){d.searchForMentions(a,function(a,c){if(h.lastSearchText==
a)if(c&&0!=c.length){k=!0;p=a;$.each(c,function(a,c){var g=h.categories.glowTabSet("createTab",{id:a,text:c.label,onClick:function(){0!=a&&(h.selectedTabText=c.label);d.showCategoryMentionables(b,c.mentionables)}});h.categories.glowTabSet("add",g)});h.categories.glowTabSet("refresh");var g=null;h.selectedTabText&&(g=h.categories.glowTabSet("getByText",h.selectedTabText),g=0<g.length?g[0]:null);g||(g=h.categories.glowTabSet("getByIndex",0));h.categories.glowTabSet("selected",g);d.showCategoryMentionables(b,
c[g.id].mentionables)}else k&&0<a.length&&(p=a.substr(0,a.length-1),k=!1),d.hideMentionables()})},249)};l.hideMentionables=function(b){h.container&&(h.container.hide(),h.selectedTabText=null);m=!1};l.getCurrentWord=function(b){var a=b.getDoc();b=b.selection.getSel();if(b.focusNode&&b.focusOffset){var a=b.focusNode.nodeValue,d=b.focusOffset-1;if(null==a||0==a.length)return"";b=0;for(var c=d;0<=c;c--)if("@"==a.charAt(c)){b=c;break}a=a.substr(b,d+1-b);if(0<a.length&&"@"==a.charAt(0).toString())return a}else if(a.selection&&
a.selection.createRange){b=a.selection.createRange();if(!(b.parentElement&&b.moveToPoint&&b.moveStart&&b.getBoundingClientRect))return"";if(null!=b.parentElement())try{b.parentElement().focus()}catch(f){}b=a.selection.createRange();a=b.getBoundingClientRect();0==a.left&&0==a.top&&(b.moveToElementText(b.parentElement()),a=b.getBoundingClientRect(),a.left=a.right);a.left+=0==b.boundingLeft?a.right-a.left:0;a.top=(a.bottom+a.top)/2;b.moveToPoint(a.left,a.top);b.moveStart("word",-1);b.moveStart("character",
-1);a=b.text;b=0;for(c=a.length-1;0<=c;c--)if("@"==a.charAt(c)){b=c;break}a=a.substr(b,a.length-b);if(0<a.length&&"@"==a.charAt(0).toString())return a}return""};l.selectMentionable=function(b,a){var d=h.mentionables.find("li.mceMentionablesSelected");if(!(0>=a.length||0==d.length)&&(d=d.data("mention"))){var c=b.selection.getRng();if(c.setStart)c.setStart(c.startContainer,c.startOffset-a.length);else if(c.parentElement&&c.getBoundingClientRect&&c.moveToPoint&&c.moveStart){var f=c.getBoundingClientRect();
0==f.left&&0==f.top&&(c.moveToElementText(c.parentElement()),f=c.getBoundingClientRect(),f.left=f.right,f.left+=0==c.boundingLeft?f.right-f.left:0,c.moveToPoint(f.left,f.top));c.moveStart("character",-1*a.length)}d={id:"mceMention"+(new Date).getTime(),contentId:d.contentid,contentTypeId:d.contenttypeid,supportsLabelHtml:d.supportslabelhtml,previewHtml:d.defaulthtml,labelHtml:"",detail:d.detail,url:d.url};b.selection.setRng(c);var c=' contenteditable="false"',f=" mceNonEditable",k="";d.supportsLabelHtml&&
(f=c="",k='<span data-mce-bogus="1">&nbsp;</span>');b.selection.setContent("<span"+c+' class="mceItem mceMention'+f+'" id="'+d.id+'" data-mce-json="'+$.telligent.evolution.html.encode(s.serialize(d,"'"))+'">'+k+d.previewHtml+"</span>"+k);b.nodeChanged();this.hideMentionables()}};l.isMentionSpan=function(b){return b&&"SPAN"===b.nodeName&&this.editor.dom.hasClass(b,"mceMention")};l.spanToObject=function(b,a){var d,c;if((d=b.attr("data-mce-json"))&&!b.isEmpty()&&(d=s.parse(d),d.contentId&&d.contentTypeId)){c=
new q("#text",3);c.raw=!0;if(d.supportsLabelHtml){for(var f=[],k=new tinyMCE.html.Serializer,h=b.firstChild;h;)"#text"==h.name||h.raw?f.push(h.value):f.push(k.serialize(h)),h=h.next;f=$.trim(f.join(""));0==f.indexOf("&nbsp;")&&(f=f.substr(6));f&&0<f.length&&f.replace(/\s+/g," ")!=d.previewHtml.replace(/\s+/g," ")?d.labelHtml=f:d.labelHtml=""}f="";d.labelHtml&&0<d.labelHtml.length&&(f=":"+$.telligent.evolution.url.serializeQuery({label:d.labelHtml}));c.value="[mention:"+d.contentId+":"+d.contentTypeId+
f+"]"}c?b.replace(c):b.remove()};l.resolveWhitespace=function(b){if(!b)return b;" "==b.substr(0,1)&&(b="&nbsp;"+b.substr(1));" "==b.substr(b.length-1)&&(b=b.substr(0,b.length-1)+"&nbsp;");return b};l.textToSpan=function(b){var a=this,d=a.editor,c;if(b.parent){for(var k=new q("div"),h=/\[mention:([a-fA-F0-9]{32}):([a-fA-F0-9]{32})(?::([^\]]*))?\]/g,l,m=0;l=h.exec(b.value);)(function(){var h={id:"mceMention"+f,contentId:RegExp.$1,contentTypeId:RegExp.$2,labelHtml:""};if(RegExp.$3){var p=$.telligent.evolution.url.parseQuery(RegExp.$3);
p&&p.label&&(h.labelHtml=p.label)}if(0<l.index)for(var p=d.parser.parse(a.resolveWhitespace(b.value.substr(m,l.index-m))).getAll("p"),t=0;t<p.length;t++)for(var u;null!=(u=p[t].walk());)k.append(u);p=new q("span",1);k.append(p);p.attr({id:h.id,"class":"mceItem mceMention mceNonEditable","data-mce-json":s.serialize(h,"'"),contenteditable:"false"});t=new q("#text",3);t.raw=!0;t.value=tinymce.util.I18n.translate("???");p.append(t);a.getMentionPreview(h,function(b,a,g,f,k){var l=d.dom.get(h.id);if(l)if(d.settings.evolution_mentionsAllowed){l.innerHTML=
b;h.previewHtml=f;h.supportsLabelHtml=a;h.detail=g;h.url=k;if(h.supportsLabelHtml){$(l).removeAttr("contenteditable").removeClass("mceNonEditable").prepend('<span data-mce-bogus="1">&nbsp;</span>');for(c=l.nextSibling;c&&3==c.nodeType&&0==c.length;)c=c.nextSibling;null==c&&$(l).after('<span data-mce-bogus="1">&nbsp;</span>');for(c=l.previousSibling;c&&3==c.nodeType&&0==c.length;)c=c.previousSibling;null==c&&$(l).before('<span data-mce-bogus="1">&nbsp;</span>')}$(l).attr("data-mce-json",s.serialize(h,
"'"))}else a=document.createElement("a"),a.href=k,a.innerHTML=b,d.dom.replace(a,l)})})(),m=h.lastIndex,f++;if(0<m){if(m<b.value.length)for(var h=d.parser.parse(a.resolveWhitespace(b.value.substr(m))).getAll("p"),p=0;p<h.length;p++)for(var t;null!=(t=h[p].walk());)k.append(t);b.replace(k);k.unwrap()}}};l.getWindowScrollOffset=function(b){var a=0,d=0;"number"==typeof b.pageXOffset?(a=b.pageXOffset,d=b.pageYOffset):b.document.body&&(b.document.body.scrollLeft||b.document.body.scrollTop)?(a=b.document.body.scrollLeft,
d=b.document.body.scrollTop):b.document.documentElement&&(b.document.documentElement.scrollLeft||b.document.documentElement.scrollTop)&&(a=document.documentElement.scrollLeft,d=document.documentElement.scrollTop);return{x:a,y:d}};l.getMentionPreview=function(b,a){b.contentId&&b.contentTypeId?$.telligent.evolution.post({url:this.getCallbackUrl({t:"p",contentid:b.contentId,contenttypeid:b.contentTypeId}),data:{labelHtml:b.labelHtml}}).then(function(b){b&&b.html&&b.defaulthtml?a(b.html,b.supportslabelhtml,
b.detail,b.defaulthtml,b.url):a("",!1,"","","")})["catch"](function(b){a("",!1,"","","")}):a("",!1,"","","")};l.searchForMentions=function(b,a){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"s",query:b,contenttypeid:this.editor.getParam("evolution_contenttypeid")||""}),success:function(d){d=tinymce.util.JSON.parse(d);try{d&&d.categories?a(b,d.categories):a(b,null)}catch(c){}},error:function(d){try{a(b,null)}catch(c){}}})};l.urlIsMentionable=function(b,a){b?$.telligent.evolution.get({url:this.getCallbackUrl({t:"u",
url:b})}).then(function(b){b&&b.success&&b.html&&b.defaulthtml?a(!0,b.html,b.supportslabelhtml,b.detail,b.defaulthtml,b.url,b.contentid,b.contenttypeid):a(!1,"",!1,"","","","","")})["catch"](function(b){a(!1,"",!1,"","","","","")}):a(!1,"",!1,"","","","","")};l.removeHtml=function(b){return $("<div></div>").html(b).text()};l.getCallbackUrl=function(b){for(var a=this.url+"../../../apis/mentions?",c={},f=this.editor.settings.evolution_contextQueryString.split(/&/g),k=0;k<f.length;k++){var h=f[k].split(/=/);
2==h.length&&(c[h[0]]=h[1])}for(var l in b)c[encodeURIComponent(l)]=encodeURIComponent(b[l]);b=!0;for(l in c)b?b=!1:a+="&",a+=l+"="+c[l];return a};l.inspectId=1;l.reviewAnchor=function(b,a){var d=this,f=$(b),k=f.prop("href"),h,l=!1;k&&((0<=k.indexOf(f.text())||f.text().endsWith(k))&&(a||0>k.indexOf("?")&&0>k.indexOf("#")))&&(h=f.prop("id"),h||(l=!0,h="i"+d.inspectId++,f.prop("id",h)),d.urlIsMentionable(k,function(b,a,g,f,k,n,p,m){a=$(c.dom.get(h));b?(b={id:h,contentId:p,contentTypeId:m,labelHtml:"",
detail:f,previewHtml:k,supportsLabelHtml:g,url:n},k=$("<span></span>").prop("id",h).attr("data-mce-json",s.serialize(b,"'")).addClass("mceItem mceMention mceNonEditable").attr("contenteditable","false").html(k),g&&k.removeClass("mceNonEditable").removeAttr("contenteditable","true").prepend('<span data-mce-bogus="1">&nbsp;</span>'),g=null,(b=c.selection.focusNode)&&b.id==h||(g=c.selection.getBookmark(2)),a.replaceWith(k),0==k.next().length&&k.after('<span data-mce-bogus="1">&nbsp;</span>'),0==k.prev().length&&
k.before('<span data-mce-bogus="1">&nbsp;</span>'),g?(c.selection.moveToBookmark(g),a=$(c.selection.getSel().focusNode),(a.is(".mceMention")||0<a.closest(".mceMention").length)&&d.escapeMention(c,k[0])):d.escapeMention(c,k[0])):l&&a.prop("id","")}))};l.nodeContainsContent=function(b){for(var a=0;a<b.children.length;a++)if("SPAN"==b.children[a].nodeName)return!0;return!1};l.getCurrentMentionNode=function(){var b;return(b=c.dom.getParent(c.selection.getStart(),function(b){return c.dom.hasClass(b,"mceMention")}))?
b:(b=c.dom.getParent(c.selection.getEnd(),function(b){return c.dom.hasClass(b,"mceMention")}))?b:null};c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(b){for(var a=b.length;a--;)l.textToSpan(b[a])});c.settings.evolution_mentionsAllowed&&(c.serializer.addNodeFilter("span",function(b,a,c){a=b.length;for(var f;a--;)f=b[a],-1!==(f.attr("class")||"").indexOf("mceMention")&&l.spanToObject(f,c)}),c.on("keydown",function(b){return l.handleKeyDown(c,b)},!0),c.on("keyup",function(b){return l.handleKeyUp(c,
b)},!0),c.on("click",function(){l.hideMentionables()}),$(document).on("click",function(b){h.container&&(h.container[0]!=b.taret&&!$.contains(h.container[0],b.target))&&l.hideMentionables()}),$("body").on("glowPopUpPanelShown glowModalOpened",function(){l.hideMentionables()}))});c.settings.evolution_mentionsAllowed&&(c.on("ResolveName",function(b){"span"===b.name&&c.dom.hasClass(b.target,"mceMention")&&(b.name=tinymce.util.I18n.translate("mention"))}),c.on("NodeChange",function(){for(var b=c.selection.getNode(),
a;b&&"SPAN"==b.nodeName&&"1"==c.dom.getAttrib(b,"data-mce-bogus");)b=b.parentNode;if(b&&"SPAN"===b.nodeName&&c.dom.hasClass(b,"mceMention"))try{for(a=b.nextSibling;a&&3==a.nodeType&&0==a.length;)a=a.nextSibling;null==a&&$(b).after('<span data-mce-bogus="1">&nbsp;</span>');for(a=b.previousSibling;a&&3==a.nodeType&&0==a.length;)a=a.previousSibling;null==a&&$(b).before('<span data-mce-bogus="1">&nbsp;</span>');var d=s.parse(c.dom.getAttrib(b,"data-mce-json"));if(d&&d.previewHtml){var f=tinymce.util.I18n.translate("Mention of {content} {detail}").replace(/\{content\}/g,
l.removeHtml(d.previewHtml)).replace(/\{detail\}/g,l.removeHtml(d.detail||""));c.execCommand("mceTip",!1,f)}}catch(k){}},!0),c.on("ExecCommand",function(b){var a=b.command.toLowerCase();"createlink"==a||"mceinsertlink"==a?(b=c.selection.getNode(),"A"==b.nodeName&&l.reviewAnchor(b)):"mceinsertcontent"==a&&b.value.paste&&(b=c.selection.getStart(),"A"==b.nodeName&&l.reviewAnchor(b))}),c.addMenuItem("removemention",{text:"Remove mention",cmd:"mceRemoveMention",stateSelector:"span.mceMention",context:"insert",
prependToContext:!0,onPostRender:function(b){var a=function(){l.getCurrentMentionNode()?b.control.show():b.control.hide()};a();c.on("NodeChange",function(){a()},!0)}}),c.addMenuItem("convertmentiontolink",{text:"Convert to link",cmd:"mceMentionToLink",icon:"link",context:"edit",prependToContext:!0,onPostRender:function(b){var a=function(){l.getCurrentMentionNode()?b.control.show():b.control.hide()};a();c.on("NodeChange",function(){a()},!0)}}),c.addMenuItem("convertmentiontopreview",{text:"Convert to preview",
cmd:"mceMentionToPreview",icon:"media",context:"edit",prependToContext:!0,onPostRender:function(b){var a=function(){l.getCurrentMentionNode()?b.control.show():b.control.hide()};a();c.on("NodeChange",function(){a()},!0)}}),c.addMenuItem("mentionurl",{text:"Convert to mention",cmd:"mceLinkToMention",context:"edit",prependToContext:!0,onPostRender:function(b){var a=function(){var a=c.selection.getNode();b.control.hide();a&&("A"==a.nodeName&&a.href&&!l.nodeContainsContent(a))&&(0!=a.href.indexOf($.telligent.evolution.site.getBaseUrl(!0))&&
0!=a.href.indexOf($.telligent.evolution.site.getBaseUrl(!1))||b.control.show())};a();c.on("NodeChange",function(){a()},!0)}}),c.addCommand("mceLinkToMention",function(){var b=c.selection.getNode();"A"==b.nodeName&&b.href&&l.reviewAnchor(b,!0)}),c.addCommand("mceRemoveMention",function(){var b=l.getCurrentMentionNode();b&&(c.dom.setOuterHTML(b,b.innerHTML),c.nodeChanged())}),c.addCommand("mceMentionToLink",function(){var b=l.getCurrentMentionNode(),a;b&&(a=c.dom.getAttrib(b,"data-mce-json"))&&(a=s.parse(a),
a.url&&(a=$("<a></a>").prop("href",a.url).text(a.url),$(b).replaceWith(a[0])))}),c.addCommand("mceMentionToPreview",function(){var b=l.getCurrentMentionNode(),a;b&&(a=c.dom.getAttrib(b,"data-mce-json"))&&(a=s.parse(a),a.url&&(a=$("<a></a>").prop("href",a.url).text(a.url),$(b).replaceWith(a[0]),c.selection.select(a[0]),c.execCommand("mceInsertMediaToPreview")))}),c.addButton("mentionremove",{text:"Remove",cmd:"mceRemoveMention"}),c.addButton("convertmentiontolink",{text:"Convert to link",cmd:"mceMentionToLink"}),
c.addButton("convertmentiontopreview",{text:"Convert to preview",cmd:"mceMentionToPreview"}),c.addContextToolbar(function(a){return c.dom.is(a,"span.mceMention")&&c.getBody().contains(a)?!0:!1},"mentionremove convertmentiontolink convertmentiontopreview"))});(function(){var c=[];tinymce.PluginManager.add("modalpopups",function(u,q){function s(a){if(!window.requestAnimationFrame)return a;var c;return function(){c&&window.cancelAnimationFrame(c);c=window.requestAnimationFrame(a)}}var m=tinymce.ui.Panel.extend({modal:!0,
Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",border:"0 0 0 0",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},modalElm:null,init:function(a){var c=this;c._super(a);c.isRtl()&&(c.classes=(c.classes||"")+" rtl");c._fixed=!1;a.buttons&&(c.statusbar=new tinymce.ui.Panel({layout:"flex",border:"0 0 0 0",spacing:3,padding:10,align:"center",pack:"start",defaults:{type:"button"},items:a.buttons,classes:"foot"}),c.statusbar.parent(c));
c.on("click",function(a){-1!=a.target.className.indexOf(c.classPrefix+"close")&&c.close()});c.on("cancel",function(){c.close()});c.aria("describedby",c.describedBy||c._id+"-none");c.aria("label",a.title);c._fullscreen=!1;c.modalElm=document.createElement("div");c.modalElm.style.visibility="hidden";$(document.getElementsByTagName("body")).append(c.modalElm);$(c.modalElm).html(c.renderHtml());c.postRender();c.reflow();window.setTimeout(function(){$(".mce-floatpanel.mce-arrow").hide();c.modalElm.style.visibility=
"visible";c.modalElm=$.glowModal({html:c.modalElm,title:a.title,focusOnOpen:!1,onClose:function(){c.modalIsClosed||(c.modalIsClosed=!0,c.close())}});a.onShown&&a.onShown.call(c)},1)},recalc:function(){var a=this.statusbar,c,p,h;this._fullscreen&&(this.layoutRect(tinymce.DOM.getWindowSize()),this.layoutRect().contentH=this.layoutRect().innerH);this._super();c=this.layoutRect();this.settings.title&&!this._fullscreen&&(p=c.headerW,p>c.w&&(h=c.x-Math.max(0,p/2),this.layoutRect({w:p,x:h}),h=!0));a&&(a.layoutRect({w:this.layoutRect().innerW}).recalc(),
p=a.layoutRect().minW+c.deltaW,p>c.w&&(h=c.x-Math.max(0,p-c.w),this.layoutRect({w:p,x:h}),h=!0));h&&this.recalc();$.glowModal.refresh()},initLayoutRect:function(){var a=this._super(),c=0;this.statusbar&&(c+=this.statusbar.layoutRect().h);a.deltaH+=c;a.minH+=c;a.h+=c;a.x=1;a.y=1;return a},close:function(){this.fire("close").isDefaultPrevented()||(this.remove(),this.modalIsClosed||$.glowModal.close(),$.glowModal.defaults.openInParentModal=this._openInParentModal);return this},renderHtml:function(){var a=
this._layout,c=this._id,p=this.settings,h="",f=p.html;this.preRender();a.preRender(this);p.url&&(f='<iframe src="'+p.url+'" tabindex="-1"></iframe>');"undefined"==typeof f&&(f=a.renderHtml(this));this.statusbar&&(h=this.statusbar.renderHtml());return'<div id="'+c+'" class="'+this.classes+'" hidefocus="1"><div class="'+this.classPrefix+'reset" role="application"><div id="'+c+'-body" class="'+this.bodyClasses+'">'+f+"</div>"+h+"</div></div>"},fullscreen:function(a){},resizeTo:function(){},resizeBy:function(){},
resizeToContent:function(){},hide:function(){},hideAll:function(){},postRender:function(){var a=this;setTimeout(function(){a.classes=(a.classes||"")+" in"},0);a._super();a.statusbar&&a.statusbar.postRender();a.focus();a.on("submit",function(c){c.isDefaultPrevented()||a.close()})},focus:function(){var a=this;window.setTimeout(function(){if(null!=a.modalElm){var c=$(a.modalElm).find('button, [href], input[type!="hidden"], select, textarea, [tabindex]:not([tabindex="-1"])').first();if(0<c.length)c.focus();
else if(c=$(a.modalElm).find("iframe").first(),0<c.length)c.on("load",function(){try{$(a.modalElm).find("iframe").get(0).contentWindow.$('button, [href], input[type!="hidden"], select, textarea, [tabindex]:not([tabindex="-1"])').first().focus()}catch(c){}})}},250)},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){this._super();this.statusbar&&this.statusbar.remove()},getContainerElm:function(){return this.modalElm},getContentWindow:function(){var a=this.getEl().getElementsByTagName("iframe")[0];
return a?a.contentWindow:null}});u.windowManager=new function(a){function k(){if(c.length)return c[c.length-1]}a.on("remove",function(){for(;0<c.length;)$.glowModal.close(),c.pop()});$(window).on("scroll",s(function(){var a=k();if(a)try{$(a.modalElm).click()}catch(c){}}));this.open=function(k,h){var f;a.editorManager.setActive(a);k.title=k.title||" ";k.url=k.url||k.file;k.url&&(k.width=parseInt(k.width||320,10),k.height=parseInt(k.height||240,10));k.body&&(k.items={defaults:k.defaults,type:k.bodyType||
"form",items:k.body});k.url||k.buttons||(k.buttons=[{text:"Ok",subtype:"primary",onclick:function(){f.find("form")[0].submit()}},{text:"Cancel",onclick:function(){f.close()}}]);var l=$.glowModal.defaults.openInParentModal;$.glowModal.defaults.openInParentModal=!1;f=new m(k);f._openInParentModal=l;f.modalIsClosed=!1;c.push(f);f.on("close",function(){for(var b=c.length;b--;)c[b]===f&&c.splice(b,1);c.length||a.focus()});if(k.data)f.on("postRender",function(){this.find("*").each(function(a){var c=a.name();
c in k.data&&a.value(k.data[c])})});f.features=k||{};f.params=h||{};1===c.length&&a.nodeChanged();return f};this.alert=function(c,k,f){window.alert(a.translate(c));k?k.call(f||this):a.focus()};this.confirm=function(c,k,f){k.call(f||this,window.confirm(a.translate(c)))};this.close=function(){k()&&k().close()};this.getParams=function(){return k()?k().params:null};this.setParams=function(a){k()&&(k().params=a)};this.getWindows=function(){return windows}}(u)})})();tinymce.PluginManager.add("preview",
function(c,u){function q(m){var a="";tinymce.util.XHR.send({url:s({t:"p",ct:c.settings.evolution_contenttypeid||""}),data:"html="+encodeURIComponent(m)+"&baseUrl="+encodeURIComponent(c.documentBaseURI.getURI()),content_type:"application/x-www-form-urlencoded",async:!1,success:function(c){c=tinymce.util.JSON.parse(c);try{c&&(c.preview?a=c.preview:c.error&&jQuery.telligent.evolution.notifications.show(c.error,{type:"error"}))}catch(m){}},error:function(a){}});return a}function s(m){for(var a=u+"../../../apis/preview?",
k={},p=c.settings.evolution_contextQueryString.split(/&/g),h=0;h<p.length;h++){var f=p[h].split(/=/);2==f.length&&(k[f[0]]=f[1])}for(var l in m)k[encodeURIComponent(l)]=encodeURIComponent(m[l]);m=!0;for(l in k)m?m=!1:a+="&",a+=l+"="+k[l];return a}c.addCommand("mcePreview",function(){var m=c.windowManager.open({title:tinymce.util.I18n.translate("Preview"),width:640,height:500,html:'<iframe src="about:blank" style="height: 500px; width:100%;" class="mcetelligent-frame with-border"></iframe>',buttons:{text:"Close",
onclick:function(){m.close()}},onShown:function(){var a=this.getEl("body").firstChild.contentWindow.document;a.open();a.write(q(c.getContent()));a.close()}})});c.addMenuItem("preview",{text:"Preview",cmd:"mcePreview",icon:"preview",context:"tools"})});tinymce.PluginManager.add("quotes",function(c,u){var q=tinymce.html.Node,s=tinymce.util.JSON,m=0,a=this;a.editor=c;a.url=u;a.getInfo=function(){return{longname:"Insert Quote",author:"Telligent",authorurl:"http://telligent.com",version:"6.5"}};a.dataToDiv=
function(a,c){var h=this.editor,f;f=this.editor.dom.create("div",{id:a.id,"class":"mceItem mceNonEditable mceQuote","data-mce-json":s.serialize(a,"'"),contenteditable:"false"});f.innerHTML="...";this.getPreview(a,function(c){var b=h.dom.get(a.id);b&&(b.innerHTML=c)});return f};a.dataToHtml=function(a,c){return this.editor.serializer.serialize(this.dataToDiv(a,c),{forced_root_block:"",force_absolute:c})};a.htmlToData=function(a){var c;c={};(a=this.editor.parser.parse(a).getAll("div")[0])&&(c=s.parse(a.attr("data-mce-json")));
return c};a.divToObject=function(a,c){var h,f;if(h=a.attr("data-mce-json"))h=s.parse(h),h.code&&(f=new q("#text",3),f.raw=!0,f.value=decodeURIComponent(h.code)),f?a.replace(f):a.remove()};a.processQuotesInHtml=function(a,c){for(var h=/(\[quote[^\]]*\][\s\S]*?\[\/quote\])/gi,f=0,l,b=[];l=h.exec(a);){var g=encodeURIComponent(RegExp.$1),g={id:"mceQuote"+m++,code:g};0<l.index&&b.push(a.substr(f,l.index-f));c?b.push('<span id="'+g.id+'" class="mceItem mceNonEditable mceQuote" contenteditable="false" data-mce-json="'+
$.telligent.evolution.html.encode(s.serialize(g,"'"))+'">...</span>'):b.push('<div id="'+g.id+'" class="mceItem mceNonEditable mceQuote" contenteditable="false" data-mce-json="'+$.telligent.evolution.html.encode(s.serialize(g,"'"))+'">...</div>');f=h.lastIndex}f<a.length&&b.push(a.substr(f));return b.join("")};a.getCallbackUrl=function(a){for(var c=this.url+"../../../apis/quotes?",h={},f=this.editor.settings.evolution_contextQueryString.split(/&/g),l=0;l<f.length;l++){var b=f[l].split(/=/);2==b.length&&
(h[b[0]]=b[1])}for(var g in a)h[encodeURIComponent(g)]=encodeURIComponent(a[g]);a=!0;for(g in h)a?a=!1:c+="&",c+=g+"="+h[g];return c};a.getPreview=function(a,c){a.code&&0!=a.code.length?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p"}),data:"bb="+a.code,content_type:"application/x-www-form-urlencoded",success:function(h){h=tinymce.util.JSON.parse(h);try{h&&h.html?c(h.html):c(decodeURIComponent(a.code))}catch(f){}},error:function(h){try{c(decodeURIComponent(a.code))}catch(f){}}}):c("")};c.on("PreInit",
function(){c.on("BeforeSetContent",function(c){c.content=a.processQuotesInHtml(c.content,c.selection)});c.parser.addNodeFilter("span",function(k){for(var m=k.length;m--;)(function(h){if(-1!==(h.attr("class")||"").indexOf("mceQuote")){var f=h.attr("data-mce-json");f&&(f=s.parse(f),f.code&&window.setTimeout(function(){var h=c.dom.get(f.id),b;if(h){b=document.createElement("div");$(b).attr({id:f.id,"data-mce-json":s.serialize(f,"'"),contenteditable:"false"}).addClass("mceItem mceQuote mceNonEditable").html("...");
if(h.parentNode&&"P"==h.parentNode.nodeName){var g=$.trim(h.parentNode.textContent||"");0!=g.length&&"..."!=g||1!=h.parentNode.children.length?($(h.parentNode).after(b),c.dom.remove(h)):c.dom.replace(b,h.parentNode,!1);$(b).after("<p><br/></p>")}else c.dom.replace(b,h,!1);a.getPreview(f,function(a){var b=c.dom.get(f.id);b&&(b.innerHTML=a)})}},1))}})(k[m])});c.parser.addNodeFilter("div",function(k){for(var m=k.length;m--;)(function(h){if(-1!==(h.attr("class")||"").indexOf("mceQuote")){var f=h.attr("data-mce-json");
f&&(f=s.parse(f),f.code&&a.getPreview(f,function(a){var b=c.dom.get(f.id);b&&(b.innerHTML=a)}))}})(k[m])});c.serializer.addNodeFilter("div",function(c,m,h){m=c.length;for(var f;m--;)f=c[m],-1!==(f.attr("class")||"").indexOf("mceQuote")&&a.divToObject(f,h)})});c.on("ResolveName",function(a){"div"===a.name&&c.dom.hasClass(a.target,"mceQuote")&&(a.name=tinymce.util.I18n.translate("Blockquote"))});c.addButton("removequote",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(a){return c.dom.hasClass(a,
"mceQuote")},"removequote")});tinymce.PluginManager.add("source",function(c){function u(){var q=c.windowManager.open({title:tinymce.util.I18n.translate("Source code"),body:[{type:"textbox",name:"code",multiline:!0,minWidth:c.getParam("code_dialog_width",600),minHeight:c.getParam("code_dialog_height",Math.min(tinymce.DOM.getViewPort().h-200,500)),spellcheck:!1,style:"direction: ltr; text-align: left"},{type:"checkbox",name:"wordwrap",label:"Wrap long lines",checked:!0,onchange:function(c){jQuery(q.find("#code")[0].getEl()).evolutionCodeEditor("wordWrap",
c.control.checked())}}],onSubmit:function(q){c.focus();var m=q.data.code;null!=m.match(/^\s*\<\!\-\-.*?\-\-\>/)&&(m="<p></p>"+m);c.undoManager.transact(function(){c.setContent(m)});c.selection.setCursorLocation();c.nodeChanged()}});q.find("#code").value(c.getContent({source_view:!0}));jQuery&&jQuery(q.find("#code")[0].getEl()).evolutionCodeEditor({mode:"html",wordWrap:!0})}c.addCommand("mceSourceEditor",u);c.addButton("source",{icon:"code",tooltip:"Source code",onclick:u});c.addMenuItem("source",
{icon:"code",text:"Source code",context:"tools",onclick:u})});tinymce.PluginManager.add("submit",function(c,u){var q=function(c){c.preventDefault();c.stopImmediatePropagation();c.stopPropagation();return!1};tinymce.ui.SubmitPanel=tinymce.ui.PanelButton.extend({init:function(c){this._super(c);this.classes.add("submitpanel");this.classes.remove("btn")},renderHtml:function(){var c=this._id,m=[];m.push('<div id="'+c+'" class="'+this.classes+'" role="presentation" aria-haspopup="false">');this.settings.editor.settings.submit_enabletoggle&&
(m.push('<div id="'+c+'_enable_wrapper" class="mce-submitpanel-message">'),m.push('<input id="'+c+'_enable" type="checkbox" role="presentation" />'),m.push('<label for="'+c+'_enable" tabindex="-1" role="presentation">'+(this.settings.editor.settings.submit_entermessage||"Press enter to send")+"</label>"),m.push("</div>"));m.push('<div class="mce-widget mce-btn mce-primary mce-btn-has-text mce-submitpanel-button" id="'+c+'_send" tabindex="0" role="button"><button style="width:100%; height:100%;" tabindex="-1" type="button"><span class="mce-txt">');
m.push(this.settings.editor.settings.submit_buttontext||"Send");m.push("</span></button></div>");m.push("</div>");return m.join("")},focus:function(){try{var c=$(this.id+"_send",this.getEl());if(0<c.length)return c.focus(),this;var m=$(this.id+"_enable",this.getEl());if(0<m.length)return m.focus(),this}catch(a){}return this},postRender:function(){function c(){var a=!1;p.is(":checked")?(k.css("display","none"),a=!0):(k.css("display","inline-block"),a=!1);null!=window.localStorage&&window.localStorage.setItem("tinymce-entertosubmit",
a.toString())}function m(a,b){for(var c=0;c<b.length;c++)if(a.nodeName==b[c])return!0;return a.parentNode?m(a.parentNode,b):!1}var a=this,k,p,h,f;f=0;h=$("#"+a._id);k=$("#"+a._id+"_send");p=$("#"+a._id+"_enable");cbx_wrapper=$("#"+a._id+"_enable_wrapper");h.closest(".mce-btn-group").css("width","100%").children("div").css("white-space","normal");var l=window["_submit_"+a.settings.editor.id]||null,b,g;l?(b=l.prehtml,g=l.posthtml):(l={},(b=a.settings.editor.settings.submittable_prehtml)&&(b=$(b)),(g=
a.settings.editor.settings.submittable_posthtml)&&(g=$(g)),l.prehtml=b,l.posthtml=g,window["_submit_"+a.settings.editor.id]=l);b&&h.prepend(b);g&&h.append(g);h.find('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').on("keydown keyup",function(a){a.stopPropagation();$(document).trigger("keydown",a)});a.settings.editor.settings.submit_enabletoggle&&(h=a.settings.editor.settings.submit_entertosubmit,null!=window.localStorage&&null!==window.localStorage.getItem("tinymce-entertosubmit")&&
(h="true"==window.localStorage.getItem("tinymce-entertosubmit")),h?(p.removeClass("mce-submitpanel-unchecked").addClass("mce-submitpanel-checked"),p.prop("checked",!0)):p.removeClass("mce-submitpanel-checked").addClass("mce-submitpanel-unchecked"),a.settings.editor.on("keydown",function(b){if(13==b.keyCode&&p.is(":checked")&&!(b.shiftKey||b.altKey||b.metaKey||b.ctrlKey)){var c=(new Date).getTime(),g=a.settings.editor.selection.getNode();if(m(g,["UL","OL","DL"]))f=c;else if(2E3<c-f)return a.settings.editor.settings.submit_onsubmit&&
a.settings.editor.settings.submit_onsubmit(a.settings.editor),q(b)}},!0),p.on("change",function(a){c()}),c());k.on("click",function(b){a.settings.editor.settings.submit_onsubmit&&a.settings.editor.settings.submit_onsubmit(a.settings.editor);return q(b)}).on("keydown",function(b){if(13==b.keyCode&&!(b.shiftKey||b.altKey||b.metaKey||b.ctrlKey))return a.settings.editor.settings.submit_onsubmit&&a.settings.editor.settings.submit_onsubmit(a.settings.editor),q(b)})}});c.on("Init",function(){var q=$(c.getContainer()),
m=function(){470<q.width()?q.removeClass("mce-submitpanel-narrow"):q.addClass("mce-submitpanel-narrow")};q.on("resized",function(){m()});m()});c.addButton("submit",{type:"SubmitPanel",editor:c})});tinymce.PluginManager.add("tips",function(c,u){var q=null,s=[],m=null,a=this;a.isDefaultNode=function(a){return null==a||"P"==a.nodeName||"BR"==a.nodeName||"BODY"==a.nodeName};a.getRandomDefaultTip=function(){return 0==s.length?"":1==s.length?s[0]:s[Math.round(Math.random()*(s.length-1))]};a.updateTip=function(a,
c){c&&(m=c);q&&q.text(a)};c.addCommand("mceTip",function(k,m){a.updateTip(m,c.selection.getNode()||"unknown");return!0});c.on("NodeChange",function(){var k=c.selection.getNode()||{nodeName:"P"};m&&m!=k&&(a.isDefaultNode(k)?a.updateTip(a.getRandomDefaultTip(),k):a.updateTip("",k))},!0);c.on("init",function(){q=jQuery('<div class="mce-first mce-flow-layout-item"></div>').css({padding:"8px",color:"rgba(0,0,0,.33)"});jQuery(".mce-container-body .mce-path",c.getContainer()).before(q);var k=c.selection.getNode()||
{nodeName:"P"};a.isDefaultNode(k)&&a.updateTip(a.getRandomDefaultTip(),k)});return{defaultTip:function(k){s.push(k);k=c.selection.getNode()||{nodeName:"P"};a.isDefaultNode(k)&&a.updateTip(a.getRandomDefaultTip(),k)}}})})();
